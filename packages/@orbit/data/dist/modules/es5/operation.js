"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var record_1 = require("./record");
var utils_1 = require("@orbit/utils");
function markOperationToDelete(operation) {
    var o = operation;
    o._deleted = true;
}
function isOperationMarkedToDelete(operation) {
    var o = operation;
    return o._deleted === true;
}
function mergeOperations(superceded, superceding, consecutiveOps) {
    if (record_1.equalRecordIdentities(superceded.record, superceding.record)) {
        if (superceding.op === 'removeRecord') {
            markOperationToDelete(superceded);
            if (superceded.op === 'addRecord') {
                markOperationToDelete(superceding);
            }
        } else if (!isOperationMarkedToDelete(superceding) && (consecutiveOps || superceding.op === 'replaceAttribute')) {
            if (isReplaceFieldOp(superceded.op) && isReplaceFieldOp(superceding.op)) {
                if (superceded.op === 'replaceAttribute' && superceding.op === 'replaceAttribute' && superceded.attribute === superceding.attribute) {
                    markOperationToDelete(superceded);
                } else if (superceded.op === 'replaceRelatedRecord' && superceding.op === 'replaceRelatedRecord' && superceded.relationship === superceding.relationship) {
                    markOperationToDelete(superceded);
                } else if (superceded.op === 'replaceRelatedRecords' && superceding.op === 'replaceRelatedRecords' && superceded.relationship === superceding.relationship) {
                    markOperationToDelete(superceded);
                } else {
                    if (superceded.op === 'replaceAttribute') {
                        updateRecordReplaceAttribute(superceded.record, superceded.attribute, superceded.value);
                        delete superceded.attribute;
                        delete superceded.value;
                    } else if (superceded.op === 'replaceRelatedRecord') {
                        updateRecordReplaceHasOne(superceded.record, superceded.relationship, superceded.relatedRecord);
                        delete superceded.relationship;
                        delete superceded.relatedRecord;
                    } else if (superceded.op === 'replaceRelatedRecords') {
                        updateRecordReplaceHasMany(superceded.record, superceded.relationship, superceded.relatedRecords);
                        delete superceded.relationship;
                        delete superceded.relatedRecords;
                    }
                    if (superceding.op === 'replaceAttribute') {
                        updateRecordReplaceAttribute(superceded.record, superceding.attribute, superceding.value);
                    } else if (superceding.op === 'replaceRelatedRecord') {
                        updateRecordReplaceHasOne(superceded.record, superceding.relationship, superceding.relatedRecord);
                    } else if (superceding.op === 'replaceRelatedRecords') {
                        updateRecordReplaceHasMany(superceded.record, superceding.relationship, superceding.relatedRecords);
                    }
                    superceded.op = 'replaceRecord';
                    markOperationToDelete(superceding);
                }
            } else if ((superceded.op === 'addRecord' || superceded.op === 'replaceRecord') && isReplaceFieldOp(superceding.op)) {
                if (superceding.op === 'replaceAttribute') {
                    updateRecordReplaceAttribute(superceded.record, superceding.attribute, superceding.value);
                } else if (superceding.op === 'replaceRelatedRecord') {
                    updateRecordReplaceHasOne(superceded.record, superceding.relationship, superceding.relatedRecord);
                } else if (superceding.op === 'replaceRelatedRecords') {
                    updateRecordReplaceHasMany(superceded.record, superceding.relationship, superceding.relatedRecords);
                }
                markOperationToDelete(superceding);
            } else if (superceding.op === 'addToRelatedRecords') {
                if (superceded.op === 'addRecord') {
                    updateRecordAddToHasMany(superceded.record, superceding.relationship, superceding.relatedRecord);
                    markOperationToDelete(superceding);
                } else if (superceded.op === 'replaceRecord') {
                    if (superceded.record.relationships && superceded.record.relationships[superceding.relationship] && superceded.record.relationships[superceding.relationship].data) {
                        updateRecordAddToHasMany(superceded.record, superceding.relationship, superceding.relatedRecord);
                        markOperationToDelete(superceding);
                    }
                }
            } else if (superceding.op === 'removeFromRelatedRecords') {
                if (superceded.op === 'addToRelatedRecords' && superceded.relationship === superceding.relationship && record_1.equalRecordIdentities(superceded.relatedRecord, superceding.relatedRecord)) {
                    markOperationToDelete(superceded);
                    markOperationToDelete(superceding);
                } else if (superceded.op === 'addRecord' || superceded.op === 'replaceRecord') {
                    if (superceded.record.relationships && superceded.record.relationships[superceding.relationship] && superceded.record.relationships[superceding.relationship].data) {
                        updateRecordRemoveFromHasMany(superceded.record, superceding.relationship, superceding.relatedRecord);
                        markOperationToDelete(superceding);
                    }
                }
            }
        }
    }
}
function isReplaceFieldOp(op) {
    return op === 'replaceAttribute' || op === 'replaceRelatedRecord' || op === 'replaceRelatedRecords';
}
function updateRecordReplaceAttribute(record, attribute, value) {
    record.attributes = record.attributes || {};
    record.attributes[attribute] = value;
}
function updateRecordReplaceHasOne(record, relationship, relatedRecord) {
    utils_1.deepSet(record, ['relationships', relationship, 'data'], record_1.cloneRecordIdentity(relatedRecord));
}
function updateRecordReplaceHasMany(record, relationship, relatedRecords) {
    utils_1.deepSet(record, ['relationships', relationship, 'data'], relatedRecords.map(record_1.cloneRecordIdentity));
}
function updateRecordAddToHasMany(record, relationship, relatedRecord) {
    var data = utils_1.deepGet(record, ['relationships', relationship, 'data']) || [];
    data.push(record_1.cloneRecordIdentity(relatedRecord));
    utils_1.deepSet(record, ['relationships', relationship, 'data'], data);
}
function updateRecordRemoveFromHasMany(record, relationship, relatedRecord) {
    var data = utils_1.deepGet(record, ['relationships', relationship, 'data']);
    if (data) {
        for (var i = 0, l = data.length; i < l; i++) {
            var r = data[i];
            if (record_1.equalRecordIdentities(r, relatedRecord)) {
                data.splice(i, 1);
                break;
            }
        }
    }
}
/**
 * Coalesces operations into a minimal set of equivalent operations.
 *
 * This method respects the order of the operations array and does not allow
 * reordering of operations that affect relationships.
 *
 * @export
 * @param {RecordOperation[]} operations
 * @returns {RecordOperation[]}
 */
function coalesceRecordOperations(operations) {
    for (var i = 0, l = operations.length; i < l; i++) {
        var currentOp = operations[i];
        var consecutiveOps = true;
        for (var j = i + 1; j < l; j++) {
            var nextOp = operations[j];
            mergeOperations(currentOp, nextOp, consecutiveOps);
            if (isOperationMarkedToDelete(currentOp)) {
                break;
            } else if (!isOperationMarkedToDelete(nextOp)) {
                consecutiveOps = false;
            }
        }
    }
    return operations.filter(function (o) {
        return !isOperationMarkedToDelete(o);
    });
}
exports.coalesceRecordOperations = coalesceRecordOperations;
/**
 * Determine the differences between a record and its updated version in terms
 * of a set of operations.
 *
 * @export
 * @param {Record} record
 * @param {Record} updatedRecord
 * @returns {RecordOperation[]}
 */
function recordDiffs(record, updatedRecord) {
    var diffs = [];
    if (record && updatedRecord) {
        var recordIdentity_1 = record_1.cloneRecordIdentity(record);
        if (updatedRecord.attributes) {
            Object.keys(updatedRecord.attributes).forEach(function (attribute) {
                var value = updatedRecord.attributes[attribute];
                if (record.attributes === undefined || !utils_1.eq(record.attributes[attribute], value)) {
                    var op = {
                        op: 'replaceAttribute',
                        record: recordIdentity_1,
                        attribute: attribute,
                        value: value
                    };
                    diffs.push(op);
                }
            });
        }
        if (updatedRecord.keys) {
            Object.keys(updatedRecord.keys).forEach(function (key) {
                var value = updatedRecord.keys[key];
                if (record.keys === undefined || !utils_1.eq(record.keys[key], value)) {
                    var op = {
                        op: 'replaceKey',
                        record: recordIdentity_1,
                        key: key,
                        value: value
                    };
                    diffs.push(op);
                }
            });
        }
        // TODO - handle relationships
    }
    return diffs;
}
exports.recordDiffs = recordDiffs;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BlcmF0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3JjL29wZXJhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx1QkFBOEY7QUFDOUYsc0JBQW9EO0FBbUpwRCwrQkFBK0IsQUFBb0I7QUFDakQsUUFBTSxBQUFDLElBQVEsQUFBUyxBQUFDO0FBQ3pCLEFBQUMsTUFBQyxBQUFRLFdBQUcsQUFBSSxBQUFDLEFBQ3BCO0FBQUM7QUFFRCxtQ0FBbUMsQUFBb0I7QUFDckQsUUFBTSxBQUFDLElBQVEsQUFBUyxBQUFDO0FBQ3pCLEFBQU0sV0FBQyxBQUFDLEVBQUMsQUFBUSxhQUFLLEFBQUksQUFBQyxBQUM3QjtBQUFDO0FBRUQseUJBQXlCLEFBQTJCLFlBQUUsQUFBNEIsYUFBRSxBQUF1QjtBQUN6RyxBQUFFLEFBQUMsUUFBQyxTQUFxQixzQkFBQyxBQUFVLFdBQUMsQUFBTSxRQUFFLEFBQVcsWUFBQyxBQUFNLEFBQUMsQUFBQyxTQUFDLEFBQUM7QUFDakUsQUFBRSxBQUFDLFlBQUMsQUFBVyxZQUFDLEFBQUUsT0FBSyxBQUFjLEFBQUMsZ0JBQUMsQUFBQztBQUN0QyxBQUFxQixrQ0FBQyxBQUFVLEFBQUMsQUFBQztBQUNsQyxBQUFFLEFBQUMsZ0JBQUMsQUFBVSxXQUFDLEFBQUUsT0FBSyxBQUFXLEFBQUMsYUFBQyxBQUFDO0FBQ2xDLEFBQXFCLHNDQUFDLEFBQVcsQUFBQyxBQUFDLEFBQ3JDO0FBQUMsQUFDSDtBQUFDLEFBQUMsQUFBSSxlQUFDLEFBQUUsQUFBQyxJQUFDLENBQUMsQUFBeUIsMEJBQUMsQUFBVyxBQUFDLEFBQUksaUJBQUMsQUFBYyxrQkFBSSxBQUFXLFlBQUMsQUFBRSxPQUFLLEFBQWtCLEFBQUMsQUFBQyxxQkFBQyxBQUFDO0FBQ2hILEFBQUUsQUFBQyxnQkFBQyxBQUFnQixpQkFBQyxBQUFVLFdBQUMsQUFBRSxBQUFDLE9BQUksQUFBZ0IsaUJBQUMsQUFBVyxZQUFDLEFBQUUsQUFBQyxBQUFDLEtB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SCxBQUFLLCtCQUFBLEFBQ047QUFMNkI7QUFPOUIsQUFBSywwQkFBQyxBQUFJLEtBQUMsQUFBRSxBQUFDLEFBQUMsQUFDakI7QUFBQyxBQUNIO0FBQUMsQUFBQyxBQUFDLEFBQ0w7QUFBQztBQUVELEFBQThCLEFBQ2hDO0FBQUM7QUFFRCxBQUFNLFdBQUMsQUFBSyxBQUFDLEFBQ2Y7QUFBQztBQTNDRCxzQkEyQ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZWNvcmQsIFJlY29yZElkZW50aXR5LCBjbG9uZVJlY29yZElkZW50aXR5LCBlcXVhbFJlY29yZElkZW50aXRpZXMgfSBmcm9tICcuL3JlY29yZCc7XHJcbmltcG9ydCB7IGVxLCBkZWVwR2V0LCBkZWVwU2V0IH0gZnJvbSAnQG9yYml0L3V0aWxzJztcclxuXHJcbi8qKlxyXG4gKiBCYXNlIE9wZXJhdGlvbiBpbnRlcmZhY2UsIHdoaWNoIHJlcXVpcmVzIGp1c3QgYW4gYG9wYCBzdHJpbmcuXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGludGVyZmFjZSBPcGVyYXRpb25cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgT3BlcmF0aW9uIHtcclxuICBvcDogc3RyaW5nO1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIHJlY29yZCBvcGVyYXRpb24uXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGludGVyZmFjZSBBZGRSZWNvcmRPcGVyYXRpb25cclxuICogQGV4dGVuZHMge09wZXJhdGlvbn1cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgQWRkUmVjb3JkT3BlcmF0aW9uIGV4dGVuZHMgT3BlcmF0aW9uIHtcclxuICBvcDogJ2FkZFJlY29yZCc7XHJcbiAgcmVjb3JkOiBSZWNvcmQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXBsYWNlIHJlY29yZCBvcGVyYXRpb24uXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGludGVyZmFjZSBSZXBsYWNlUmVjb3JkT3BlcmF0aW9uXHJcbiAqIEBleHRlbmRzIHtPcGVyYXRpb259XHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFJlcGxhY2VSZWNvcmRPcGVyYXRpb24gZXh0ZW5kcyBPcGVyYXRpb24ge1xyXG4gIG9wOiAncmVwbGFjZVJlY29yZCc7XHJcbiAgcmVjb3JkOiBSZWNvcmQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZW1vdmUgcmVjb3JkIG9wZXJhdGlvbi5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAaW50ZXJmYWNlIFJlbW92ZVJlY29yZE9wZXJhdGlvblxyXG4gKiBAZXh0ZW5kcyB7T3BlcmF0aW9ufVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBSZW1vdmVSZWNvcmRPcGVyYXRpb24gZXh0ZW5kcyBPcGVyYXRpb24ge1xyXG4gIG9wOiAncmVtb3ZlUmVjb3JkJztcclxuICByZWNvcmQ6IFJlY29yZElkZW50aXR5O1xyXG59XHJcblxyXG4vKipcclxuICogUmVwbGFjZSBrZXkgb3BlcmF0aW9uLlxyXG4gKlxyXG4gKiBAZXhwb3J0XHJcbiAqIEBpbnRlcmZhY2UgUmVwbGFjZUtleU9wZXJhdGlvblxyXG4gKiBAZXh0ZW5kcyB7T3BlcmF0aW9ufVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBSZXBsYWNlS2V5T3BlcmF0aW9uIGV4dGVuZHMgT3BlcmF0aW9uIHtcclxuICBvcDogJ3JlcGxhY2VLZXknO1xyXG4gIHJlY29yZDogUmVjb3JkSWRlbnRpdHk7XHJcbiAga2V5OiBzdHJpbmc7XHJcbiAgdmFsdWU6IHN0cmluZztcclxufVxyXG5cclxuLyoqXHJcbiAqIFJlcGxhY2UgYXR0cmlidXRlIG9wZXJhdGlvbi5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAaW50ZXJmYWNlIFJlcGxhY2VBdHRyaWJ1dGVPcGVyYXRpb25cclxuICogQGV4dGVuZHMge09wZXJhdGlvbn1cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmVwbGFjZUF0dHJpYnV0ZU9wZXJhdGlvbiBleHRlbmRzIE9wZXJhdGlvbiB7XHJcbiAgb3A6ICdyZXBsYWNlQXR0cmlidXRlJztcclxuICByZWNvcmQ6IFJlY29yZElkZW50aXR5O1xyXG4gIGF0dHJpYnV0ZTogc3RyaW5nO1xyXG4gIHZhbHVlOiBhbnk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgdG8gaGFzLW1hbnkgcmVsYXRpb25zaGlwIG9wZXJhdGlvbi5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAaW50ZXJmYWNlIEFkZFRvUmVsYXRlZFJlY29yZHNPcGVyYXRpb25cclxuICogQGV4dGVuZHMge09wZXJhdGlvbn1cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgQWRkVG9SZWxhdGVkUmVjb3Jkc09wZXJhdGlvbiBleHRlbmRzIE9wZXJhdGlvbiB7XHJcbiAgb3A6ICdhZGRUb1JlbGF0ZWRSZWNvcmRzJztcclxuICByZWNvcmQ6IFJlY29yZElkZW50aXR5O1xyXG4gIHJlbGF0aW9uc2hpcDogc3RyaW5nO1xyXG4gIHJlbGF0ZWRSZWNvcmQ6IFJlY29yZElkZW50aXR5O1xyXG59XHJcblxyXG4vKipcclxuICogUmVtb3ZlIGZyb20gaGFzLW1hbnkgcmVsYXRpb25zaGlwIG9wZXJhdGlvbi5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAaW50ZXJmYWNlIFJlbW92ZUZyb21SZWxhdGVkUmVjb3Jkc09wZXJhdGlvblxyXG4gKiBAZXh0ZW5kcyB7T3BlcmF0aW9ufVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBSZW1vdmVGcm9tUmVsYXRlZFJlY29yZHNPcGVyYXRpb24gZXh0ZW5kcyBPcGVyYXRpb24ge1xyXG4gIG9wOiAncmVtb3ZlRnJvbVJlbGF0ZWRSZWNvcmRzJztcclxuICByZWNvcmQ6IFJlY29yZElkZW50aXR5O1xyXG4gIHJlbGF0aW9uc2hpcDogc3RyaW5nO1xyXG4gIHJlbGF0ZWRSZWNvcmQ6IFJlY29yZElkZW50aXR5O1xyXG59XHJcblxyXG4vKipcclxuICogUmVwbGFjZSBoYXMtbWFueSByZWxhdGlvbnNoaXAgb3BlcmF0aW9uLlxyXG4gKlxyXG4gKiBAZXhwb3J0XHJcbiAqIEBpbnRlcmZhY2UgUmVwbGFjZVJlbGF0ZWRSZWNvcmRzT3BlcmF0aW9uXHJcbiAqIEBleHRlbmRzIHtPcGVyYXRpb259XHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFJlcGxhY2VSZWxhdGVkUmVjb3Jkc09wZXJhdGlvbiBleHRlbmRzIE9wZXJhdGlvbiB7XHJcbiAgb3A6ICdyZXBsYWNlUmVsYXRlZFJlY29yZHMnO1xyXG4gIHJlY29yZDogUmVjb3JkSWRlbnRpdHk7XHJcbiAgcmVsYXRpb25zaGlwOiBzdHJpbmc7XHJcbiAgcmVsYXRlZFJlY29yZHM6IFJlY29yZElkZW50aXR5W107XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXBsYWNlIGhhcy1vbmUgcmVsYXRpb25zaGlwIG9wZXJhdGlvbi5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAaW50ZXJmYWNlIFJlcGxhY2VSZWxhdGVkUmVjb3JkT3BlcmF0aW9uXHJcbiAqIEBleHRlbmRzIHtPcGVyYXRpb259XHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFJlcGxhY2VSZWxhdGVkUmVjb3JkT3BlcmF0aW9uIGV4dGVuZHMgT3BlcmF0aW9uIHtcclxuICBvcDogJ3JlcGxhY2VSZWxhdGVkUmVjb3JkJztcclxuICByZWNvcmQ6IFJlY29yZElkZW50aXR5O1xyXG4gIHJlbGF0aW9uc2hpcDogc3RyaW5nO1xyXG4gIHJlbGF0ZWRSZWNvcmQ6IFJlY29yZElkZW50aXR5IHwgbnVsbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFVuaW9uIG9mIGFsbCByZWNvcmQtcmVsYXRlZCBvcGVyYXRpb25zLlxyXG4gKlxyXG4gKiBAZXhwb3J0XHJcbiAqL1xyXG5leHBvcnQgdHlwZSBSZWNvcmRPcGVyYXRpb24gPSBBZGRSZWNvcmRPcGVyYXRpb24gfFxyXG4gIFJlcGxhY2VSZWNvcmRPcGVyYXRpb24gfFxyXG4gIFJlbW92ZVJlY29yZE9wZXJhdGlvbiB8XHJcbiAgUmVwbGFjZUtleU9wZXJhdGlvbiB8XHJcbiAgUmVwbGFjZUF0dHJpYnV0ZU9wZXJhdGlvbiB8XHJcbiAgQWRkVG9SZWxhdGVkUmVjb3Jkc09wZXJhdGlvbiB8XHJcbiAgUmVtb3ZlRnJvbVJlbGF0ZWRSZWNvcmRzT3BlcmF0aW9uIHxcclxuICBSZXBsYWNlUmVsYXRlZFJlY29yZHNPcGVyYXRpb24gfFxyXG4gIFJlcGxhY2VSZWxhdGVkUmVjb3JkT3BlcmF0aW9uO1xyXG5cclxuZnVuY3Rpb24gbWFya09wZXJhdGlvblRvRGVsZXRlKG9wZXJhdGlvbjogT3BlcmF0aW9uKTogdm9pZCB7XHJcbiAgY29uc3QgbzogYW55ID0gb3BlcmF0aW9uO1xyXG4gIG8uX2RlbGV0ZWQgPSB0cnVlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc09wZXJhdGlvbk1hcmtlZFRvRGVsZXRlKG9wZXJhdGlvbjogT3BlcmF0aW9uKTogYm9vbGVhbiB7XHJcbiAgY29uc3QgbzogYW55ID0gb3BlcmF0aW9uO1xyXG4gIHJldHVybiBvLl9kZWxldGVkID09PSB0cnVlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtZXJnZU9wZXJhdGlvbnMoc3VwZXJjZWRlZDogUmVjb3JkT3BlcmF0aW9uLCBzdXBlcmNlZGluZzogUmVjb3JkT3BlcmF0aW9uLCBjb25zZWN1dGl2ZU9wczogYm9vbGVhbik6IHZvaWQge1xyXG4gIGlmIChlcXVhbFJlY29yZElkZW50aXRpZXMoc3VwZXJjZWRlZC5yZWNvcmQsIHN1cGVyY2VkaW5nLnJlY29yZCkpIHtcclxuICAgIGlmIChzdXBlcmNlZGluZy5vcCA9PT0gJ3JlbW92ZVJlY29yZCcpIHtcclxuICAgICAgbWFya09wZXJhdGlvblRvRGVsZXRlKHN1cGVyY2VkZWQpO1xyXG4gICAgICBpZiAoc3VwZXJjZWRlZC5vcCA9PT0gJ2FkZFJlY29yZCcpIHtcclxuICAgICAgICBtYXJrT3BlcmF0aW9uVG9EZWxldGUoc3VwZXJjZWRpbmcpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKCFpc09wZXJhdGlvbk1hcmtlZFRvRGVsZXRlKHN1cGVyY2VkaW5nKSAmJiAoY29uc2VjdXRpdmVPcHMgfHwgc3VwZXJjZWRpbmcub3AgPT09ICdyZXBsYWNlQXR0cmlidXRlJykpIHtcclxuICAgICAgaWYgKGlzUmVwbGFjZUZpZWxkT3Aoc3VwZXJjZWRlZC5vcCkgJiYgaXNSZXBsYWNlRmllbGRPcChzdXBlcmNlZGluZy5vcCkpIHtcclxuICAgICAgICBpZiAoc3VwZXJjZWRlZC5vcCA9PT0gJ3JlcGxhY2VBdHRyaWJ1dGUnICYmXHJcbiAgICAgICAgICAgIHN1cGVyY2VkaW5nLm9wID09PSAncmVwbGFjZUF0dHJpYnV0ZScgJiZcclxuICAgICAgICAgICAgc3VwZXJjZWRlZC5hdHRyaWJ1dGUgPT09IHN1cGVyY2VkaW5nLmF0dHJpYnV0ZSkge1xyXG4gICAgICAgICAgbWFya09wZXJhdGlvblRvRGVsZXRlKHN1cGVyY2VkZWQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc3VwZXJjZWRlZC5vcCA9PT0gJ3JlcGxhY2VSZWxhdGVkUmVjb3JkJyAmJlxyXG4gICAgICAgICAgICBzdXBlcmNlZGluZy5vcCA9PT0gJ3JlcGxhY2VSZWxhdGVkUmVjb3JkJyAmJlxyXG4gICAgICAgICAgICBzdXBlcmNlZGVkLnJlbGF0aW9uc2hpcCA9PT0gc3VwZXJjZWRpbmcucmVsYXRpb25zaGlwKSB7XHJcbiAgICAgICAgICBtYXJrT3BlcmF0aW9uVG9EZWxldGUoc3VwZXJjZWRlZCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChzdXBlcmNlZGVkLm9wID09PSAncmVwbGFjZVJlbGF0ZWRSZWNvcmRzJyAmJlxyXG4gICAgICAgICAgICBzdXBlcmNlZGluZy5vcCA9PT0gJ3JlcGxhY2VSZWxhdGVkUmVjb3JkcycgJiZcclxuICAgICAgICAgICAgc3VwZXJjZWRlZC5yZWxhdGlvbnNoaXAgPT09IHN1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcCkge1xyXG4gICAgICAgICAgbWFya09wZXJhdGlvblRvRGVsZXRlKHN1cGVyY2VkZWQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAoc3VwZXJjZWRlZC5vcCA9PT0gJ3JlcGxhY2VBdHRyaWJ1dGUnKSB7XHJcbiAgICAgICAgICAgIHVwZGF0ZVJlY29yZFJlcGxhY2VBdHRyaWJ1dGUoc3VwZXJjZWRlZC5yZWNvcmQsIHN1cGVyY2VkZWQuYXR0cmlidXRlLCBzdXBlcmNlZGVkLnZhbHVlKTtcclxuICAgICAgICAgICAgZGVsZXRlIHN1cGVyY2VkZWQuYXR0cmlidXRlO1xyXG4gICAgICAgICAgICBkZWxldGUgc3VwZXJjZWRlZC52YWx1ZTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoc3VwZXJjZWRlZC5vcCA9PT0gJ3JlcGxhY2VSZWxhdGVkUmVjb3JkJykge1xyXG4gICAgICAgICAgICB1cGRhdGVSZWNvcmRSZXBsYWNlSGFzT25lKHN1cGVyY2VkZWQucmVjb3JkLCBzdXBlcmNlZGVkLnJlbGF0aW9uc2hpcCwgc3VwZXJjZWRlZC5yZWxhdGVkUmVjb3JkKTtcclxuICAgICAgICAgICAgZGVsZXRlIHN1cGVyY2VkZWQucmVsYXRpb25zaGlwO1xyXG4gICAgICAgICAgICBkZWxldGUgc3VwZXJjZWRlZC5yZWxhdGVkUmVjb3JkO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChzdXBlcmNlZGVkLm9wID09PSAncmVwbGFjZVJlbGF0ZWRSZWNvcmRzJykge1xyXG4gICAgICAgICAgICB1cGRhdGVSZWNvcmRSZXBsYWNlSGFzTWFueShzdXBlcmNlZGVkLnJlY29yZCwgc3VwZXJjZWRlZC5yZWxhdGlvbnNoaXAsIHN1cGVyY2VkZWQucmVsYXRlZFJlY29yZHMpO1xyXG4gICAgICAgICAgICBkZWxldGUgc3VwZXJjZWRlZC5yZWxhdGlvbnNoaXA7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBzdXBlcmNlZGVkLnJlbGF0ZWRSZWNvcmRzO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKHN1cGVyY2VkaW5nLm9wID09PSAncmVwbGFjZUF0dHJpYnV0ZScpIHtcclxuICAgICAgICAgICAgdXBkYXRlUmVjb3JkUmVwbGFjZUF0dHJpYnV0ZShzdXBlcmNlZGVkLnJlY29yZCwgc3VwZXJjZWRpbmcuYXR0cmlidXRlLCBzdXBlcmNlZGluZy52YWx1ZSk7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKHN1cGVyY2VkaW5nLm9wID09PSAncmVwbGFjZVJlbGF0ZWRSZWNvcmQnKSB7XHJcbiAgICAgICAgICAgIHVwZGF0ZVJlY29yZFJlcGxhY2VIYXNPbmUoc3VwZXJjZWRlZC5yZWNvcmQsIHN1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcCwgc3VwZXJjZWRpbmcucmVsYXRlZFJlY29yZCk7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKHN1cGVyY2VkaW5nLm9wID09PSAncmVwbGFjZVJlbGF0ZWRSZWNvcmRzJykge1xyXG4gICAgICAgICAgICB1cGRhdGVSZWNvcmRSZXBsYWNlSGFzTWFueShzdXBlcmNlZGVkLnJlY29yZCwgc3VwZXJjZWRpbmcucmVsYXRpb25zaGlwLCBzdXBlcmNlZGluZy5yZWxhdGVkUmVjb3Jkcyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzdXBlcmNlZGVkLm9wID0gJ3JlcGxhY2VSZWNvcmQnO1xyXG4gICAgICAgICAgbWFya09wZXJhdGlvblRvRGVsZXRlKHN1cGVyY2VkaW5nKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSBpZiAoKHN1cGVyY2VkZWQub3AgPT09ICdhZGRSZWNvcmQnIHx8IHN1cGVyY2VkZWQub3AgPT09ICdyZXBsYWNlUmVjb3JkJykgJiZcclxuICAgICAgICAgICAgICAgICBpc1JlcGxhY2VGaWVsZE9wKHN1cGVyY2VkaW5nLm9wKSkge1xyXG4gICAgICAgIGlmIChzdXBlcmNlZGluZy5vcCA9PT0gJ3JlcGxhY2VBdHRyaWJ1dGUnKSB7XHJcbiAgICAgICAgICB1cGRhdGVSZWNvcmRSZXBsYWNlQXR0cmlidXRlKHN1cGVyY2VkZWQucmVjb3JkLCBzdXBlcmNlZGluZy5hdHRyaWJ1dGUsIHN1cGVyY2VkaW5nLnZhbHVlKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHN1cGVyY2VkaW5nLm9wID09PSAncmVwbGFjZVJlbGF0ZWRSZWNvcmQnKSB7XHJcbiAgICAgICAgICB1cGRhdGVSZWNvcmRSZXBsYWNlSGFzT25lKHN1cGVyY2VkZWQucmVjb3JkLCBzdXBlcmNlZGluZy5yZWxhdGlvbnNoaXAsIHN1cGVyY2VkaW5nLnJlbGF0ZWRSZWNvcmQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc3VwZXJjZWRpbmcub3AgPT09ICdyZXBsYWNlUmVsYXRlZFJlY29yZHMnKSB7XHJcbiAgICAgICAgICB1cGRhdGVSZWNvcmRSZXBsYWNlSGFzTWFueShzdXBlcmNlZGVkLnJlY29yZCwgc3VwZXJjZWRpbmcucmVsYXRpb25zaGlwLCBzdXBlcmNlZGluZy5yZWxhdGVkUmVjb3Jkcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShzdXBlcmNlZGluZyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoc3VwZXJjZWRpbmcub3AgPT09ICdhZGRUb1JlbGF0ZWRSZWNvcmRzJykge1xyXG4gICAgICAgIGlmIChzdXBlcmNlZGVkLm9wID09PSAnYWRkUmVjb3JkJykge1xyXG4gICAgICAgICAgdXBkYXRlUmVjb3JkQWRkVG9IYXNNYW55KHN1cGVyY2VkZWQucmVjb3JkLCBzdXBlcmNlZGluZy5yZWxhdGlvbnNoaXAsIHN1cGVyY2VkaW5nLnJlbGF0ZWRSZWNvcmQpO1xyXG4gICAgICAgICAgbWFya09wZXJhdGlvblRvRGVsZXRlKHN1cGVyY2VkaW5nKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHN1cGVyY2VkZWQub3AgPT09ICdyZXBsYWNlUmVjb3JkJykge1xyXG4gICAgICAgICAgaWYgKHN1cGVyY2VkZWQucmVjb3JkLnJlbGF0aW9uc2hpcHMgJiZcclxuICAgICAgICAgICAgICBzdXBlcmNlZGVkLnJlY29yZC5yZWxhdGlvbnNoaXBzW3N1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcF0gJiZcclxuICAgICAgICAgICAgICBzdXBlcmNlZGVkLnJlY29yZC5yZWxhdGlvbnNoaXBzW3N1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcF0uZGF0YSkge1xyXG4gICAgICAgICAgICB1cGRhdGVSZWNvcmRBZGRUb0hhc01hbnkoc3VwZXJjZWRlZC5yZWNvcmQsIHN1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcCwgc3VwZXJjZWRpbmcucmVsYXRlZFJlY29yZCk7XHJcbiAgICAgICAgICAgIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShzdXBlcmNlZGluZyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKHN1cGVyY2VkaW5nLm9wID09PSAncmVtb3ZlRnJvbVJlbGF0ZWRSZWNvcmRzJykge1xyXG4gICAgICAgIGlmIChzdXBlcmNlZGVkLm9wID09PSAnYWRkVG9SZWxhdGVkUmVjb3JkcycgJiZcclxuICAgICAgICAgICAgc3VwZXJjZWRlZC5yZWxhdGlvbnNoaXAgPT09IHN1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcCAmJlxyXG4gICAgICAgICAgICBlcXVhbFJlY29yZElkZW50aXRpZXMoc3VwZXJjZWRlZC5yZWxhdGVkUmVjb3JkLCBzdXBlcmNlZGluZy5yZWxhdGVkUmVjb3JkKSkge1xyXG4gICAgICAgICAgbWFya09wZXJhdGlvblRvRGVsZXRlKHN1cGVyY2VkZWQpO1xyXG4gICAgICAgICAgbWFya09wZXJhdGlvblRvRGVsZXRlKHN1cGVyY2VkaW5nKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHN1cGVyY2VkZWQub3AgPT09ICdhZGRSZWNvcmQnIHx8IHN1cGVyY2VkZWQub3AgPT09ICdyZXBsYWNlUmVjb3JkJykge1xyXG4gICAgICAgICAgaWYgKHN1cGVyY2VkZWQucmVjb3JkLnJlbGF0aW9uc2hpcHMgJiZcclxuICAgICAgICAgICAgICBzdXBlcmNlZGVkLnJlY29yZC5yZWxhdGlvbnNoaXBzW3N1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcF0gJiZcclxuICAgICAgICAgICAgICBzdXBlcmNlZGVkLnJlY29yZC5yZWxhdGlvbnNoaXBzW3N1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcF0uZGF0YSkge1xyXG4gICAgICAgICAgICB1cGRhdGVSZWNvcmRSZW1vdmVGcm9tSGFzTWFueShzdXBlcmNlZGVkLnJlY29yZCwgc3VwZXJjZWRpbmcucmVsYXRpb25zaGlwLCBzdXBlcmNlZGluZy5yZWxhdGVkUmVjb3JkKTtcclxuICAgICAgICAgICAgbWFya09wZXJhdGlvblRvRGVsZXRlKHN1cGVyY2VkaW5nKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzUmVwbGFjZUZpZWxkT3Aob3A6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gIHJldHVybiAob3AgPT09ICdyZXBsYWNlQXR0cmlidXRlJyB8fFxyXG4gICAgICAgICAgb3AgPT09ICdyZXBsYWNlUmVsYXRlZFJlY29yZCcgfHxcclxuICAgICAgICAgIG9wID09PSAncmVwbGFjZVJlbGF0ZWRSZWNvcmRzJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVJlY29yZFJlcGxhY2VBdHRyaWJ1dGUocmVjb3JkOiBSZWNvcmQsIGF0dHJpYnV0ZTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XHJcbiAgcmVjb3JkLmF0dHJpYnV0ZXMgPSByZWNvcmQuYXR0cmlidXRlcyB8fCB7fTtcclxuICByZWNvcmQuYXR0cmlidXRlc1thdHRyaWJ1dGVdID0gdmFsdWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVJlY29yZFJlcGxhY2VIYXNPbmUocmVjb3JkOiBSZWNvcmQsIHJlbGF0aW9uc2hpcDogc3RyaW5nLCByZWxhdGVkUmVjb3JkOiBSZWNvcmRJZGVudGl0eSkge1xyXG4gIGRlZXBTZXQocmVjb3JkLCBbJ3JlbGF0aW9uc2hpcHMnLCByZWxhdGlvbnNoaXAsICdkYXRhJ10sIGNsb25lUmVjb3JkSWRlbnRpdHkocmVsYXRlZFJlY29yZCkpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVSZWNvcmRSZXBsYWNlSGFzTWFueShyZWNvcmQ6IFJlY29yZCwgcmVsYXRpb25zaGlwOiBzdHJpbmcsIHJlbGF0ZWRSZWNvcmRzOiBSZWNvcmRJZGVudGl0eVtdKSB7XHJcbiAgZGVlcFNldChyZWNvcmQsIFsncmVsYXRpb25zaGlwcycsIHJlbGF0aW9uc2hpcCwgJ2RhdGEnXSwgcmVsYXRlZFJlY29yZHMubWFwKGNsb25lUmVjb3JkSWRlbnRpdHkpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlUmVjb3JkQWRkVG9IYXNNYW55KHJlY29yZDogUmVjb3JkLCByZWxhdGlvbnNoaXA6IHN0cmluZywgcmVsYXRlZFJlY29yZDogUmVjb3JkSWRlbnRpdHkpIHtcclxuICBjb25zdCBkYXRhID0gZGVlcEdldChyZWNvcmQsIFsncmVsYXRpb25zaGlwcycsIHJlbGF0aW9uc2hpcCwgJ2RhdGEnXSkgfHwgW107XHJcbiAgZGF0YS5wdXNoKGNsb25lUmVjb3JkSWRlbnRpdHkocmVsYXRlZFJlY29yZCkpO1xyXG4gIGRlZXBTZXQocmVjb3JkLCBbJ3JlbGF0aW9uc2hpcHMnLCByZWxhdGlvbnNoaXAsICdkYXRhJ10sIGRhdGEpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVSZWNvcmRSZW1vdmVGcm9tSGFzTWFueShyZWNvcmQ6IFJlY29yZCwgcmVsYXRpb25zaGlwOiBzdHJpbmcsIHJlbGF0ZWRSZWNvcmQ6IFJlY29yZElkZW50aXR5KSB7XHJcbiAgY29uc3QgZGF0YSA9IGRlZXBHZXQocmVjb3JkLCBbJ3JlbGF0aW9uc2hpcHMnLCByZWxhdGlvbnNoaXAsICdkYXRhJ10pIGFzIFJlY29yZElkZW50aXR5W107XHJcbiAgaWYgKGRhdGEpIHtcclxuICAgIGZvciAobGV0IGkgPSAwLCBsID0gZGF0YS5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuICAgICAgbGV0IHIgPSBkYXRhW2ldO1xyXG4gICAgICBpZiAoZXF1YWxSZWNvcmRJZGVudGl0aWVzKHIsIHJlbGF0ZWRSZWNvcmQpKSB7XHJcbiAgICAgICAgZGF0YS5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb2FsZXNjZXMgb3BlcmF0aW9ucyBpbnRvIGEgbWluaW1hbCBzZXQgb2YgZXF1aXZhbGVudCBvcGVyYXRpb25zLlxyXG4gKlxyXG4gKiBUaGlzIG1ldGhvZCByZXNwZWN0cyB0aGUgb3JkZXIgb2YgdGhlIG9wZXJhdGlvbnMgYXJyYXkgYW5kIGRvZXMgbm90IGFsbG93XHJcbiAqIHJlb3JkZXJpbmcgb2Ygb3BlcmF0aW9ucyB0aGF0IGFmZmVjdCByZWxhdGlvbnNoaXBzLlxyXG4gKlxyXG4gKiBAZXhwb3J0XHJcbiAqIEBwYXJhbSB7UmVjb3JkT3BlcmF0aW9uW119IG9wZXJhdGlvbnNcclxuICogQHJldHVybnMge1JlY29yZE9wZXJhdGlvbltdfVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNvYWxlc2NlUmVjb3JkT3BlcmF0aW9ucyhvcGVyYXRpb25zOiBSZWNvcmRPcGVyYXRpb25bXSk6IFJlY29yZE9wZXJhdGlvbltdIHtcclxuICBmb3IgKGxldCBpID0gMCwgbCA9IG9wZXJhdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcbiAgICBsZXQgY3VycmVudE9wID0gb3BlcmF0aW9uc1tpXTtcclxuICAgIGxldCBjb25zZWN1dGl2ZU9wcyA9IHRydWU7XHJcblxyXG4gICAgZm9yIChsZXQgaiA9IGkgKyAxOyBqIDwgbDsgaisrKSB7XHJcbiAgICAgIGxldCBuZXh0T3AgPSBvcGVyYXRpb25zW2pdO1xyXG5cclxuICAgICAgbWVyZ2VPcGVyYXRpb25zKGN1cnJlbnRPcCwgbmV4dE9wLCBjb25zZWN1dGl2ZU9wcyk7XHJcblxyXG4gICAgICBpZiAoaXNPcGVyYXRpb25NYXJrZWRUb0RlbGV0ZShjdXJyZW50T3ApKSB7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH0gZWxzZSBpZiAoIWlzT3BlcmF0aW9uTWFya2VkVG9EZWxldGUobmV4dE9wKSkge1xyXG4gICAgICAgIGNvbnNlY3V0aXZlT3BzID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBvcGVyYXRpb25zLmZpbHRlcihvID0+ICFpc09wZXJhdGlvbk1hcmtlZFRvRGVsZXRlKG8pKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIERldGVybWluZSB0aGUgZGlmZmVyZW5jZXMgYmV0d2VlbiBhIHJlY29yZCBhbmQgaXRzIHVwZGF0ZWQgdmVyc2lvbiBpbiB0ZXJtc1xyXG4gKiBvZiBhIHNldCBvZiBvcGVyYXRpb25zLlxyXG4gKlxyXG4gKiBAZXhwb3J0XHJcbiAqIEBwYXJhbSB7UmVjb3JkfSByZWNvcmRcclxuICogQHBhcmFtIHtSZWNvcmR9IHVwZGF0ZWRSZWNvcmRcclxuICogQHJldHVybnMge1JlY29yZE9wZXJhdGlvbltdfVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHJlY29yZERpZmZzKHJlY29yZDogUmVjb3JkLCB1cGRhdGVkUmVjb3JkOiBSZWNvcmQpOiBSZWNvcmRPcGVyYXRpb25bXSB7XHJcbiAgY29uc3QgZGlmZnM6IFJlY29yZE9wZXJhdGlvbltdID0gW107XHJcblxyXG4gIGlmIChyZWNvcmQgJiYgdXBkYXRlZFJlY29yZCkge1xyXG4gICAgY29uc3QgcmVjb3JkSWRlbnRpdHkgPSBjbG9uZVJlY29yZElkZW50aXR5KHJlY29yZCk7XHJcblxyXG4gICAgaWYgKHVwZGF0ZWRSZWNvcmQuYXR0cmlidXRlcykge1xyXG4gICAgICBPYmplY3Qua2V5cyh1cGRhdGVkUmVjb3JkLmF0dHJpYnV0ZXMpLmZvckVhY2goYXR0cmlidXRlID0+IHtcclxuICAgICAgICBsZXQgdmFsdWUgPSB1cGRhdGVkUmVjb3JkLmF0dHJpYnV0ZXNbYXR0cmlidXRlXTtcclxuXHJcbiAgICAgICAgaWYgKHJlY29yZC5hdHRyaWJ1dGVzID09PSB1bmRlZmluZWQgfHwgIWVxKHJlY29yZC5hdHRyaWJ1dGVzW2F0dHJpYnV0ZV0sIHZhbHVlKSkge1xyXG4gICAgICAgICAgbGV0IG9wOiBSZXBsYWNlQXR0cmlidXRlT3BlcmF0aW9uID0ge1xyXG4gICAgICAgICAgICBvcDogJ3JlcGxhY2VBdHRyaWJ1dGUnLFxyXG4gICAgICAgICAgICByZWNvcmQ6IHJlY29yZElkZW50aXR5LFxyXG4gICAgICAgICAgICBhdHRyaWJ1dGUsXHJcbiAgICAgICAgICAgIHZhbHVlXHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgZGlmZnMucHVzaChvcCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodXBkYXRlZFJlY29yZC5rZXlzKSB7XHJcbiAgICAgIE9iamVjdC5rZXlzKHVwZGF0ZWRSZWNvcmQua2V5cykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgIGxldCB2YWx1ZSA9IHVwZGF0ZWRSZWNvcmQua2V5c1trZXldO1xyXG4gICAgICAgIGlmIChyZWNvcmQua2V5cyA9PT0gdW5kZWZpbmVkIHx8ICFlcShyZWNvcmQua2V5c1trZXldLCB2YWx1ZSkpIHtcclxuICAgICAgICAgIGxldCBvcDogUmVwbGFjZUtleU9wZXJhdGlvbiA9IHtcclxuICAgICAgICAgICAgb3A6ICdyZXBsYWNlS2V5JyxcclxuICAgICAgICAgICAgcmVjb3JkOiByZWNvcmRJZGVudGl0eSxcclxuICAgICAgICAgICAga2V5LFxyXG4gICAgICAgICAgICB2YWx1ZVxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGRpZmZzLnB1c2gob3ApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVE9ETyAtIGhhbmRsZSByZWxhdGlvbnNoaXBzXHJcbiAgfVxyXG5cclxuICByZXR1cm4gZGlmZnM7XHJcbn1cclxuIl19