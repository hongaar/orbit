"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var record_1 = require("./record");
var utils_1 = require("@orbit/utils");
function markOperationToDelete(operation) {
    var o = operation;
    o._deleted = true;
}
function isOperationMarkedToDelete(operation) {
    var o = operation;
    return o._deleted === true;
}
function mergeOperations(superceded, superceding, consecutiveOps) {
    if (record_1.equalRecordIdentities(superceded.record, superceding.record)) {
        if (superceding.op === 'removeRecord') {
            markOperationToDelete(superceded);
            if (superceded.op === 'addRecord') {
                markOperationToDelete(superceding);
            }
        } else if (!isOperationMarkedToDelete(superceding) && (consecutiveOps || superceding.op === 'replaceAttribute')) {
            if (isReplaceFieldOp(superceded.op) && isReplaceFieldOp(superceding.op)) {
                if (superceded.op === 'replaceAttribute' && superceding.op === 'replaceAttribute' && superceded.attribute === superceding.attribute) {
                    markOperationToDelete(superceded);
                } else if (superceded.op === 'replaceRelatedRecord' && superceding.op === 'replaceRelatedRecord' && superceded.relationship === superceding.relationship) {
                    markOperationToDelete(superceded);
                } else if (superceded.op === 'replaceRelatedRecords' && superceding.op === 'replaceRelatedRecords' && superceded.relationship === superceding.relationship) {
                    markOperationToDelete(superceded);
                } else {
                    if (superceded.op === 'replaceAttribute') {
                        updateRecordReplaceAttribute(superceded.record, superceded.attribute, superceded.value);
                        delete superceded.attribute;
                        delete superceded.value;
                    } else if (superceded.op === 'replaceRelatedRecord') {
                        updateRecordReplaceHasOne(superceded.record, superceded.relationship, superceded.relatedRecord);
                        delete superceded.relationship;
                        delete superceded.relatedRecord;
                    } else if (superceded.op === 'replaceRelatedRecords') {
                        updateRecordReplaceHasMany(superceded.record, superceded.relationship, superceded.relatedRecords);
                        delete superceded.relationship;
                        delete superceded.relatedRecords;
                    }
                    if (superceding.op === 'replaceAttribute') {
                        updateRecordReplaceAttribute(superceded.record, superceding.attribute, superceding.value);
                    } else if (superceding.op === 'replaceRelatedRecord') {
                        updateRecordReplaceHasOne(superceded.record, superceding.relationship, superceding.relatedRecord);
                    } else if (superceding.op === 'replaceRelatedRecords') {
                        updateRecordReplaceHasMany(superceded.record, superceding.relationship, superceding.relatedRecords);
                    }
                    superceded.op = 'replaceRecord';
                    markOperationToDelete(superceding);
                }
            } else if ((superceded.op === 'addRecord' || superceded.op === 'replaceRecord') && isReplaceFieldOp(superceding.op)) {
                if (superceding.op === 'replaceAttribute') {
                    updateRecordReplaceAttribute(superceded.record, superceding.attribute, superceding.value);
                } else if (superceding.op === 'replaceRelatedRecord') {
                    updateRecordReplaceHasOne(superceded.record, superceding.relationship, superceding.relatedRecord);
                } else if (superceding.op === 'replaceRelatedRecords') {
                    updateRecordReplaceHasMany(superceded.record, superceding.relationship, superceding.relatedRecords);
                }
                markOperationToDelete(superceding);
            } else if (superceding.op === 'addToRelatedRecords') {
                if (superceded.op === 'addRecord') {
                    updateRecordAddToHasMany(superceded.record, superceding.relationship, superceding.relatedRecord);
                    markOperationToDelete(superceding);
                } else if (superceded.op === 'replaceRecord') {
                    if (superceded.record.relationships && superceded.record.relationships[superceding.relationship] && superceded.record.relationships[superceding.relationship].data) {
                        updateRecordAddToHasMany(superceded.record, superceding.relationship, superceding.relatedRecord);
                        markOperationToDelete(superceding);
                    }
                }
            } else if (superceding.op === 'removeFromRelatedRecords') {
                if (superceded.op === 'addToRelatedRecords' && superceded.relationship === superceding.relationship && record_1.equalRecordIdentities(superceded.relatedRecord, superceding.relatedRecord)) {
                    markOperationToDelete(superceded);
                    markOperationToDelete(superceding);
                } else if (superceded.op === 'addRecord' || superceded.op === 'replaceRecord') {
                    if (superceded.record.relationships && superceded.record.relationships[superceding.relationship] && superceded.record.relationships[superceding.relationship].data) {
                        updateRecordRemoveFromHasMany(superceded.record, superceding.relationship, superceding.relatedRecord);
                        markOperationToDelete(superceding);
                    }
                }
            }
        }
    }
}
function isReplaceFieldOp(op) {
    return op === 'replaceAttribute' || op === 'replaceRelatedRecord' || op === 'replaceRelatedRecords';
}
function updateRecordReplaceAttribute(record, attribute, value) {
    record.attributes = record.attributes || {};
    record.attributes[attribute] = value;
}
function updateRecordReplaceHasOne(record, relationship, relatedRecord) {
    utils_1.deepSet(record, ['relationships', relationship, 'data'], record_1.cloneRecordIdentity(relatedRecord));
}
function updateRecordReplaceHasMany(record, relationship, relatedRecords) {
    utils_1.deepSet(record, ['relationships', relationship, 'data'], relatedRecords.map(record_1.cloneRecordIdentity));
}
function updateRecordAddToHasMany(record, relationship, relatedRecord) {
    var data = utils_1.deepGet(record, ['relationships', relationship, 'data']) || [];
    data.push(record_1.cloneRecordIdentity(relatedRecord));
    utils_1.deepSet(record, ['relationships', relationship, 'data'], data);
}
function updateRecordRemoveFromHasMany(record, relationship, relatedRecord) {
    var data = utils_1.deepGet(record, ['relationships', relationship, 'data']);
    if (data) {
        for (var i = 0, l = data.length; i < l; i++) {
            var r = data[i];
            if (record_1.equalRecordIdentities(r, relatedRecord)) {
                data.splice(i, 1);
                break;
            }
        }
    }
}
/**
 * Coalesces operations into a minimal set of equivalent operations.
 *
 * This method respects the order of the operations array and does not allow
 * reordering of operations that affect relationships.
 *
 * @export
 * @param {RecordOperation[]} operations
 * @returns {RecordOperation[]}
 */
function coalesceRecordOperations(operations) {
    for (var i = 0, l = operations.length; i < l; i++) {
        var currentOp = operations[i];
        var consecutiveOps = true;
        for (var j = i + 1; j < l; j++) {
            var nextOp = operations[j];
            mergeOperations(currentOp, nextOp, consecutiveOps);
            if (isOperationMarkedToDelete(currentOp)) {
                break;
            } else if (!isOperationMarkedToDelete(nextOp)) {
                consecutiveOps = false;
            }
        }
    }
    return operations.filter(function (o) {
        return !isOperationMarkedToDelete(o);
    });
}
exports.coalesceRecordOperations = coalesceRecordOperations;
/**
 * Determine the differences between a record and its updated version in terms
 * of a set of operations.
 *
 * @export
 * @param {Record} record
 * @param {Record} updatedRecord
 * @returns {RecordOperation[]}
 */
function recordDiffs(record, updatedRecord) {
    var diffs = [];
    if (record && updatedRecord) {
        var recordIdentity_1 = record_1.cloneRecordIdentity(record);
        if (updatedRecord.attributes) {
            Object.keys(updatedRecord.attributes).forEach(function (attribute) {
                var value = updatedRecord.attributes[attribute];
                if (record.attributes === undefined || !utils_1.eq(record.attributes[attribute], value)) {
                    var op = {
                        op: 'replaceAttribute',
                        record: recordIdentity_1,
                        attribute: attribute,
                        value: value
                    };
                    diffs.push(op);
                }
            });
        }
        if (updatedRecord.keys) {
            Object.keys(updatedRecord.keys).forEach(function (key) {
                var value = updatedRecord.keys[key];
                if (record.keys === undefined || !utils_1.eq(record.keys[key], value)) {
                    var op = {
                        op: 'replaceKey',
                        record: recordIdentity_1,
                        key: key,
                        value: value
                    };
                    diffs.push(op);
                }
            });
        }
        // TODO - handle relationships
    }
    return diffs;
}
exports.recordDiffs = recordDiffs;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BlcmF0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3JjL29wZXJhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx1QkFBOEY7QUFDOUYsc0JBQW9EO0FBbUpwRCwrQkFBK0IsQUFBb0IsV0FDakQ7UUFBTSxBQUFDLElBQVEsQUFBUyxBQUFDLEFBQ3pCLEFBQUM7TUFBQyxBQUFRLFdBQUcsQUFBSSxBQUFDLEFBQ3BCLEFBQUM7O0FBRUQsbUNBQW1DLEFBQW9CLFdBQ3JEO1FBQU0sQUFBQyxJQUFRLEFBQVMsQUFBQyxBQUN6QixBQUFNO1dBQUMsQUFBQyxFQUFDLEFBQVEsYUFBSyxBQUFJLEFBQUMsQUFDN0IsQUFBQzs7QUFFRCx5QkFBeUIsQUFBMkIsWUFBRSxBQUE0QixhQUFFLEFBQXVCLGdCQUN6RyxBQUFFLEFBQUM7UUFBQyxTQUFxQixzQkFBQyxBQUFVLFdBQUMsQUFBTSxRQUFFLEFBQVcsWUFBQyxBQUFNLEFBQUMsQUFBQyxTQUFDLEFBQUMsQUFDakUsQUFBRSxBQUFDO1lBQUMsQUFBVyxZQUFDLEFBQUUsT0FBSyxBQUFjLEFBQUMsZ0JBQUMsQUFBQyxBQUN0QyxBQUFxQjtrQ0FBQyxBQUFVLEFBQUMsQUFBQyxBQUNsQyxBQUFFLEFBQUM7Z0JBQUMsQUFBVSxXQUFDLEFBQUUsT0FBSyxBQUFXLEFBQUMsYUFBQyxBQUFDLEFBQ2xDLEFBQXFCO3NDQUFDLEFBQVcsQUFBQyxBQUFDLEFBQ3JDLEFBQUMsQUFDSDtBQUFDLEFBQUMsQUFBSTtlQUFDLEFBQUUsQUFBQyxJQUFDLENBQUMsQUFBeUIsMEJBQUMsQUFBVyxBQUFDLEFBQUksaUJBQUMsQUFBYyxrQkFBSSxBQUFXLFlBQUMsQUFBRSxPQUFLLEFBQWtCLEFBQUMsQUFBQyxxQkFBQyxBQUFDLEFBQ2hILEFBQUUsQUFBQztnQkFBQyxBQUFnQixpQkFBQyxBQUFVLFdBQUMsQUFBRSxBQUFDLE9BQUksQUFBZ0IsaUJBQUMsQUFBVyxZQUFDLEFBQUUsQUFBQyxBQUFDLEtBQUMsQUFBQyxBQUN4RSxBQUFFLEFBQUM7b0JBQUMsQUFBVSxXQUFDLEFBQUUsT0FBSyxBQUFrQixzQkFDcEMsQUFBVyxZQUFDLEFBQUUsT0FBSyxBQUFrQixzQkFDckMsQUFBVSxXQUFDLEFBQVMsY0FBSyxBQUFXLFlBQUMsQUFBUyxBQUFDLFdBQUMsQUFBQyxBQUNuRCxBQUFxQjswQ0FBQyxBQUFVLEFBQUMsQUFBQyxBQUNwQyxBQUFDLEFBQUMsQUFBSTsyQkFBSyxBQUFVLFdBQUMsQUFBRSxPQUFLLEFBQXNCLDBCQUMvQyxBQUFXLFlBQUMsQUFBRSxPQUFLLEFBQXNCLDBCQUN6QyxBQUFVLFdBQUMsQUFBWSxpQkFBSyxBQUFXLFlBQUMsQUFBWSxBQUFDLGNBQUMsQUFBQyxBQUN6RCxBQUFxQjswQ0FBQyxBQUFVLEFBQUMsQUFBQyxBQUNwQyxBQUFDLEFBQUMsQUFBSTtBQUpDLEFBQUUsQUFBQywyQkFJQyxBQUFVLFdBQUMsQUFBRSxPQUFLLEFBQXVCLDJCQUNoRCxBQUFXLFlBQUMsQUFBRSxPQUFLLEFBQXVCLDJCQUMxQyxBQUFVLFdBQUMsQUFBWSxpQkFBSyxBQUFXLFlBQUMsQUFBWSxBQUFDLGNBQUMsQUFBQyxBQUN6RCxBQUFxQjswQ0FBQyxBQUFVLEFBQUMsQUFBQyxBQUNwQyxBQUFDLEFBQUMsQUFBSTtBQUpDLEFBQUUsQUFBQyx1QkFJSCxBQUFDLEFBQ04sQUFBRSxBQUFDO3dCQUFDLEFBQVUsV0FBQyxBQUFFLE9BQUssQUFBa0IsQUFBQyxvQkFBQyxBQUFDLEFBQ3pDLEFBQTRCO3FEQUFDLEFBQVUsV0FBQyxBQUFNLFFBQUUsQUFBVSxXQUFDLEFBQVMsV0FBRSxBQUFVLFdBQUMsQUFBSyxBQUFDLEFBQUMsQUFDeEY7K0JBQU8sQUFBVSxXQUFDLEFBQVMsQUFBQyxBQUM1QjsrQkFBTyxBQUFVLFdBQUMsQUFBSyxBQUFDLEFBQzFCLEFBQUMsQUFBQyxBQUFJOytCQUFLLEFBQVUsV0FBQyxBQUFFLE9BQUssQUFBc0IsQUFBQyx3QkFBQyxBQUFDLEFBQ3BELEFBQXlCO2tEQUFDLEFBQVUsV0FBQyxBQUFNLFFBQUUsQUFBVSxXQUFDLEFBQVksY0FBRSxBQUFVLFdBQUMsQUFBYSxBQUFDLEFBQUMsQUFDaEc7K0JBQU8sQUFBVSxXQUFDLEFBQVksQUFBQyxBQUMvQjsrQkFBTyxBQUFVLFdBQUMsQUFBYSxBQUFDLEFBQ2xDLEFBQUMsQUFBQyxBQUFJO0FBSkMsQUFBRSxBQUFDLDJCQUlILEFBQUUsQUFBQyxJQUFDLEFBQVUsV0FBQyxBQUFFLE9BQUssQUFBdUIsQUFBQyx5QkFBQyxBQUFDLEFBQ3JELEFBQTBCO21EQUFDLEFBQVUsV0FBQyxBQUFNLFFBQUUsQUFBVSxXQUFDLEFBQVksY0FBRSxBQUFVLFdBQUMsQUFBYyxBQUFDLEFBQUMsQUFDbEc7K0JBQU8sQUFBVSxXQUFDLEFBQVksQUFBQyxBQUMvQjsrQkFBTyxBQUFVLFdBQUMsQUFBYyxBQUFDLEFBQ25DLEFBQUM7QUFDRCxBQUFFLEFBQUM7d0JBQUMsQUFBVyxZQUFDLEFBQUUsT0FBSyxBQUFrQixBQUFDLG9CQUFDLEFBQUMsQUFDMUMsQUFBNEI7cURBQUMsQUFBVSxXQUFDLEFBQU0sUUFBRSxBQUFXLFlBQUMsQUFBUyxXQUFFLEFBQVcsWUFBQyxBQUFLLEFBQUMsQUFBQyxBQUM1RixBQUFDLEFBQUMsQUFBSTsrQkFBSyxBQUFXLFlBQUMsQUFBRSxPQUFLLEFBQXNCLEFBQUMsd0JBQUMsQUFBQyxBQUNyRCxBQUF5QjtrREFBQyxBQUFVLFdBQUMsQUFBTSxRQUFFLEFBQVcsWUFBQyxBQUFZLGNBQUUsQUFBVyxZQUFDLEFBQWEsQUFBQyxBQUFDLEFBQ3BHLEFBQUMsQUFBQyxBQUFJO0FBRkMsQUFBRSxBQUFDLDJCQUVILEFBQUUsQUFBQyxJQUFDLEFBQVcsWUFBQyxBQUFFLE9BQUssQUFBdUIsQUFBQyx5QkFBQyxBQUFDLEFBQ3RELEFBQTBCO21EQUFDLEFBQVUsV0FBQyxBQUFNLFFBQUUsQUFBVyxZQUFDLEFBQVksY0FBRSxBQUFXLFlBQUMsQUFBYyxBQUFDLEFBQUMsQUFDdEcsQUFBQztBQUNELEFBQVU7K0JBQUMsQUFBRSxLQUFHLEFBQWUsQUFBQyxBQUNoQyxBQUFxQjswQ0FBQyxBQUFXLEFBQUMsQUFBQyxBQUNyQyxBQUFDLEFBQ0g7QUFBQyxBQUFDLEFBQUk7dUJBQUssQ0FBQyxBQUFVLFdBQUMsQUFBRSxPQUFLLEFBQVcsZUFBSSxBQUFVLFdBQUMsQUFBRSxPQUFLLEFBQWUsQUFBQyxvQkFDcEUsQUFBZ0IsaUJBQUMsQUFBVyxZQUFDLEFBQUUsQUFBQyxBQUFDLEtBQUMsQUFBQyxBQUM1QyxBQUFFLEFBQUM7b0JBQUMsQUFBVyxZQUFDLEFBQUUsT0FBSyxBQUFrQixBQUFDLG9CQUFDLEFBQUMsQUFDMUMsQUFBNEI7aURBQUMsQUFBVSxXQUFDLEFBQU0sUUFBRSxBQUFXLFlBQUMsQUFBUyxXQUFFLEFBQVcsWUFBQyxBQUFLLEFBQUMsQUFBQyxBQUM1RixBQUFDLEFBQUMsQUFBSTsyQkFBSyxBQUFXLFlBQUMsQUFBRSxPQUFLLEFBQXNCLEFBQUMsd0JBQUMsQUFBQyxBQUNyRCxBQUF5Qjs4Q0FBQyxBQUFVLFdBQUMsQUFBTSxRQUFFLEFBQVcsWUFBQyxBQUFZLGNBQUUsQUFBVyxZQUFDLEFBQWEsQUFBQyxBQUFDLEFBQ3BHLEFBQUMsQUFBQyxBQUFJO0FBRkMsQUFBRSxBQUFDLHVCQUVILEFBQUUsQUFBQyxJQUFDLEFBQVcsWUFBQyxBQUFFLE9BQUssQUFBdUIsQUFBQyx5QkFBQyxBQUFDLEFBQ3RELEFBQTBCOytDQUFDLEFBQVUsV0FBQyxBQUFNLFFBQUUsQUFBVyxZQUFDLEFBQVksY0FBRSxBQUFXLFlBQUMsQUFBYyxBQUFDLEFBQUMsQUFDdEcsQUFBQztBQUNELEFBQXFCO3NDQUFDLEFBQVcsQUFBQyxBQUFDLEFBQ3JDLEFBQUMsQUFBQyxBQUFJO0FBVkMsQUFBRSxBQUFDLHVCQVVDLEFBQVcsWUFBQyxBQUFFLE9BQUssQUFBcUIsQUFBQyx1QkFBQyxBQUFDLEFBQ3BELEFBQUUsQUFBQztvQkFBQyxBQUFVLFdBQUMsQUFBRSxPQUFLLEFBQVcsQUFBQyxhQUFDLEFBQUMsQUFDbEMsQUFBd0I7NkNBQUMsQUFBVSxXQUFDLEFBQU0sUUFBRSxBQUFXLFlBQUMsQUFBWSxjQUFFLEFBQVcsWUFBQyxBQUFhLEFBQUMsQUFBQyxBQUNqRyxBQUFxQjswQ0FBQyxBQUFXLEFBQUMsQUFBQyxBQUNyQyxBQUFDLEFBQUMsQUFBSTt1QkFBQyxBQUFFLEFBQUMsSUFBQyxBQUFVLFdBQUMsQUFBRSxPQUFLLEFBQWUsQUFBQyxpQkFBQyxBQUFDLEFBQzdDLEFBQUUsQUFBQzt3QkFBQyxBQUFVLFdBQUMsQUFBTSxPQUFDLEFBQWEsaUJBQy9CLEFBQVUsV0FBQyxBQUFNLE9BQUMsQUFBYSxjQUFDLEFBQVcsWUFBQyxBQUFZLEFBQUMsaUJBQ3pELEFBQVUsV0FBQyxBQUFNLE9BQUMsQUFBYSxjQUFDLEFBQVcsWUFBQyxBQUFZLEFBQUMsY0FBQyxBQUFJLEFBQUMsTUFBQyxBQUFDLEFBQ25FLEFBQXdCO2lEQUFDLEFBQVUsV0FBQyxBQUFNLFFBQUUsQUFBVyxZQUFDLEFBQVksY0FBRSxBQUFXLFlBQUMsQUFBYSxBQUFDLEFBQUMsQUFDakcsQUFBcUI7OENBQUMsQUFBVyxBQUFDLEFBQUMsQUFDckMsQUFBQyxBQUNIO0FBQUMsQUFDSDtBQUFDLEFBQUMsQUFBSTtBQVpDLEFBQUUsQUFBQyxtQkFZSCxBQUFFLEFBQUMsSUFBQyxBQUFXLFlBQUMsQUFBRSxPQUFLLEFBQTBCLEFBQUMsNEJBQUMsQUFBQyxBQUN6RCxBQUFFLEFBQUM7b0JBQUMsQUFBVSxXQUFDLEFBQUUsT0FBSyxBQUFxQix5QkFDdkMsQUFBVSxXQUFDLEFBQVksaUJBQUssQUFBVyxZQUFDLEFBQVksZ0JBQ3BELFNBQXFCLHNCQUFDLEFBQVUsV0FBQyxBQUFhLGVBQUUsQUFBVyxZQUFDLEFBQWEsQUFBQyxBQUFDLGdCQUFDLEFBQUMsQUFDL0UsQUFBcUI7MENBQUMsQUFBVSxBQUFDLEFBQUMsQUFDbEMsQUFBcUI7MENBQUMsQUFBVyxBQUFDLEFBQUMsQUFDckMsQUFBQyxBQUFDLEFBQUk7dUJBQUMsQUFBRSxBQUFDLElBQUMsQUFBVSxXQUFDLEFBQUUsT0FBSyxBQUFXLGVBQUksQUFBVSxXQUFDLEFBQUUsT0FBSyxBQUFlLEFBQUMsaUJBQUMsQUFBQyxBQUM5RSxBQUFFLEFBQUM7d0JBQUMsQUFBVSxXQUFDLEFBQU0sT0FBQyxBQUFhLGlCQUMvQixBQUFVLFdBQUMsQUFBTSxPQUFDLEFBQWEsY0FBQyxBQUFXLFlBQUMsQUFBWSxBQUFDLGlCQUN6RCxBQUFVLFdBQUMsQUFBTSxPQUFDLEFBQWEsY0FBQyxBQUFXLFlBQUMsQUFBWSxBQUFDLGNBQUMsQUFBSSxBQUFDLE1BQUMsQUFBQyxBQUNuRSxBQUE2QjtzREFBQyxBQUFVLFdBQUMsQUFBTSxRQUFFLEFBQVcsWUFBQyxBQUFZLGNBQUUsQUFBVyxZQUFDLEFBQWEsQUFBQyxBQUFDLEFBQ3RHLEFBQXFCOzhDQUFDLEFBQVcsQUFBQyxBQUFDLEFBQ3JDLEFBQUMsQUFDSDtBQUFDLEFBQ0g7QUFBQyxBQUNIO0FBQUMsQUFDSDtBQUFDLEFBQ0g7QUFBQzs7QUFFRCwwQkFBMEIsQUFBVSxJQUNsQyxBQUFNLEFBQUM7V0FBQyxBQUFFLE9BQUssQUFBa0Isc0JBQ3pCLEFBQUUsT0FBSyxBQUFzQiwwQkFDN0IsQUFBRSxPQUFLLEFBQXVCLEFBQUMsQUFBQyxBQUMxQyxBQUFDOztBQUVELHNDQUFzQyxBQUFjLFFBQUUsQUFBaUIsV0FBRSxBQUFVLE9BQ2pGLEFBQU07V0FBQyxBQUFVLGFBQUcsQUFBTSxPQUFDLEFBQVUsY0FBSSxBQUFFLEFBQUMsQUFDNUMsQUFBTTtXQUFDLEFBQVUsV0FBQyxBQUFTLEFBQUMsYUFBRyxBQUFLLEFBQUMsQUFDdkMsQUFBQzs7QUFFRCxtQ0FBbUMsQUFBYyxRQUFFLEFBQW9CLGNBQUUsQUFBNkIsZUFDcEc7WUFBTyxRQUFDLEFBQU0sUUFBRSxDQUFDLEFBQWUsaUJBQUUsQUFBWSxjQUFFLEFBQU0sQUFBQyxTQUFFLFNBQW1CLG9CQUFDLEFBQWEsQUFBQyxBQUFDLEFBQUMsQUFDL0YsQUFBQzs7QUFFRCxvQ0FBb0MsQUFBYyxRQUFFLEFBQW9CLGNBQUUsQUFBZ0MsZ0JBQ3hHO1lBQU8sUUFBQyxBQUFNLFFBQUUsQ0FBQyxBQUFlLGlCQUFFLEFBQVksY0FBRSxBQUFNLEFBQUMsU0FBRSxBQUFjLGVBQUMsQUFBRyxJQUFDLFNBQW1CLEFBQUMsQUFBQyxBQUFDLEFBQ3BHLEFBQUM7O0FBRUQsa0NBQWtDLEFBQWMsUUFBRSxBQUFvQixjQUFFLEFBQTZCLGVBQ25HO1FBQU0sQUFBSSxPQUFHLFFBQU8sUUFBQyxBQUFNLFFBQUUsQ0FBQyxBQUFlLGlCQUFFLEFBQVksY0FBRSxBQUFNLEFBQUMsQUFBQyxZQUFJLEFBQUUsQUFBQyxBQUM1RSxBQUFJO1NBQUMsQUFBSSxLQUFDLFNBQW1CLG9CQUFDLEFBQWEsQUFBQyxBQUFDLEFBQUMsQUFDOUM7WUFBTyxRQUFDLEFBQU0sUUFBRSxDQUFDLEFBQWUsaUJBQUUsQUFBWSxjQUFFLEFBQU0sQUFBQyxTQUFFLEFBQUksQUFBQyxBQUFDLEFBQ2pFLEFBQUM7O0FBRUQsdUNBQXVDLEFBQWMsUUFBRSxBQUFvQixjQUFFLEFBQTZCLGVBQ3hHO1FBQU0sQUFBSSxPQUFHLFFBQU8sUUFBQyxBQUFNLFFBQUUsQ0FBQyxBQUFlLGlCQUFFLEFBQVksY0FBRSxBQUFNLEFBQUMsQUFBcUIsQUFBQyxBQUMxRixBQUFFLEFBQUM7UUFBQyxBQUFJLEFBQUMsTUFBQyxBQUFDLEFBQ1QsQUFBRyxBQUFDO2FBQUMsSUFBSSxBQUFDLElBQUcsQUFBQyxHQUFFLEFBQUMsSUFBRyxBQUFJLEtBQUMsQUFBTSxRQUFFLEFBQUMsSUFBRyxBQUFDLEdBQUUsQUFBQyxBQUFFLEtBQUUsQUFBQyxBQUM1QztnQkFBSSxBQUFDLElBQUcsQUFBSSxLQUFDLEFBQUMsQUFBQyxBQUFDLEFBQ2hCLEFBQUUsQUFBQztnQkFBQyxTQUFxQixzQkFBQyxBQUFDLEdBQUUsQUFBYSxBQUFDLEFBQUMsZ0JBQUMsQUFBQyxBQUM1QyxBQUFJO3FCQUFDLEFBQU0sT0FBQyxBQUFDLEdBQUUsQUFBQyxBQUFDLEFBQUMsQUFDbEIsQUFBSyxBQUFDLEFBQ1I7QUFBQyxBQUNIO0FBQUMsQUFDSDtBQUFDLEFBQ0g7QUFBQzs7QUFFRCxBQVNHOzs7Ozs7Ozs7O0FBQ0gsa0NBQXlDLEFBQTZCLFlBQ3BFLEFBQUcsQUFBQztTQUFDLElBQUksQUFBQyxJQUFHLEFBQUMsR0FBRSxBQUFDLElBQUcsQUFBVSxXQUFDLEFBQU0sUUFBRSxBQUFDLElBQUcsQUFBQyxHQUFFLEFBQUMsQUFBRSxLQUFFLEFBQUMsQUFDbEQ7WUFBSSxBQUFTLFlBQUcsQUFBVSxXQUFDLEFBQUMsQUFBQyxBQUFDLEFBQzlCO1lBQUksQUFBYyxpQkFBRyxBQUFJLEFBQUMsQUFFMUIsQUFBRyxBQUFDO2FBQUMsSUFBSSxBQUFDLElBQUcsQUFBQyxJQUFHLEFBQUMsR0FBRSxBQUFDLElBQUcsQUFBQyxHQUFFLEFBQUMsQUFBRSxLQUFFLEFBQUMsQUFDL0I7Z0JBQUksQUFBTSxTQUFHLEFBQVUsV0FBQyxBQUFDLEFBQUMsQUFBQyxBQUUzQixBQUFlOzRCQUFDLEFBQVMsV0FBRSxBQUFNLFFBQUUsQUFBYyxBQUFDLEFBQUMsQUFFbkQsQUFBRSxBQUFDO2dCQUFDLEFBQXlCLDBCQUFDLEFBQVMsQUFBQyxBQUFDLFlBQUMsQUFBQyxBQUN6QyxBQUFLLEFBQUMsQUFDUjtBQUFDLEFBQUMsQUFBSTttQkFBQyxBQUFFLEFBQUMsSUFBQyxDQUFDLEFBQXlCLDBCQUFDLEFBQU0sQUFBQyxBQUFDLFNBQUMsQUFBQyxBQUM5QyxBQUFjO2lDQUFHLEFBQUssQUFBQyxBQUN6QixBQUFDLEFBQ0g7QUFBQyxBQUNIO0FBQUM7QUFFRCxBQUFNO3NCQUFZLEFBQU0sT0FBQyxVQUFBLEFBQUMsR0FBSTtlQUFBLENBQUMsQUFBeUIsMEJBQTFCLEFBQTJCLEFBQUMsQUFBQyxBQUFDLEFBQUMsQUFDL0Q7QUFEUyxBQUFVLEFBQ2xCOztBQW5CRCxtQ0FtQkM7QUFFRCxBQVFHOzs7Ozs7Ozs7QUFDSCxxQkFBNEIsQUFBYyxRQUFFLEFBQXFCLGVBQy9EO1FBQU0sQUFBSyxRQUFzQixBQUFFLEFBQUMsQUFFcEMsQUFBRSxBQUFDO1FBQUMsQUFBTSxVQUFJLEFBQWEsQUFBQyxlQUFDLEFBQUMsQUFDNUI7WUFBTSxBQUFjLG1CQUFHLFNBQW1CLG9CQUFDLEFBQU0sQUFBQyxBQUFDLEFBRW5ELEFBQUUsQUFBQztZQUFDLEFBQWEsY0FBQyxBQUFVLEFBQUMsWUFBQyxBQUFDLEFBQzdCLEFBQU07bUJBQUMsQUFBSSxLQUFDLEFBQWEsY0FBQyxBQUFVLEFBQUMsWUFBQyxBQUFPLFFBQUMsVUFBQSxBQUFTLFdBQ3JEO29CQUFJLEFBQUssUUFBRyxBQUFhLGNBQUMsQUFBVSxXQUFDLEFBQVMsQUFBQyxBQUFDLEFBRWhELEFBQUUsQUFBQztvQkFBQyxBQUFNLE9BQUMsQUFBVSxlQUFLLEFBQVMsYUFBSSxDQUFDLFFBQUUsR0FBQyxBQUFNLE9BQUMsQUFBVSxXQUFDLEFBQVMsQUFBQyxZQUFFLEFBQUssQUFBQyxBQUFDLFFBQUMsQUFBQyxBQUNoRjt3QkFBSSxBQUFFOzRCQUNBLEFBQWtCLEFBQ3RCLEFBQU07Z0NBQUUsQUFBYyxBQUN0QixBQUFTO21DQUFBLEFBQ1QsQUFBSzsrQkFKNkIsQUFJN0IsQUFDTixBQUVELEFBQUs7QUFOSCxBQUFFOzBCQU1FLEFBQUksS0FBQyxBQUFFLEFBQUMsQUFBQyxBQUNqQixBQUFDLEFBQ0g7QUFBQyxBQUFDLEFBQUMsQUFDTDtBQUFDO0FBRUQsQUFBRSxBQUFDO1lBQUMsQUFBYSxjQUFDLEFBQUksQUFBQyxNQUFDLEFBQUMsQUFDdkIsQUFBTTttQkFBQyxBQUFJLEtBQUMsQUFBYSxjQUFDLEFBQUksQUFBQyxNQUFDLEFBQU8sUUFBQyxVQUFBLEFBQUcsS0FDekM7b0JBQUksQUFBSyxRQUFHLEFBQWEsY0FBQyxBQUFJLEtBQUMsQUFBRyxBQUFDLEFBQUMsQUFDcEMsQUFBRSxBQUFDO29CQUFDLEFBQU0sT0FBQyxBQUFJLFNBQUssQUFBUyxhQUFJLENBQUMsUUFBRSxHQUFDLEFBQU0sT0FBQyxBQUFJLEtBQUMsQUFBRyxBQUFDLE1BQUUsQUFBSyxBQUFDLEFBQUMsUUFBQyxBQUFDLEFBQzlEO3dCQUFJLEFBQUU7NEJBQ0EsQUFBWSxBQUNoQixBQUFNO2dDQUFFLEFBQWMsQUFDdEIsQUFBRzs2QkFBQSxBQUNILEFBQUs7K0JBSnVCLEFBSXZCLEFBQ04sQUFFRCxBQUFLO0FBTkgsQUFBRTswQkFNRSxBQUFJLEtBQUMsQUFBRSxBQUFDLEFBQUMsQUFDakIsQUFBQyxBQUNIO0FBQUMsQUFBQyxBQUFDLEFBQ0w7QUFBQztBQUVELEFBQThCLEFBQ2hDO0FBQUM7QUFFRCxBQUFNO1dBQUMsQUFBSyxBQUFDLEFBQ2YsQUFBQzs7QUEzQ0Qsc0JBMkNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVjb3JkLCBSZWNvcmRJZGVudGl0eSwgY2xvbmVSZWNvcmRJZGVudGl0eSwgZXF1YWxSZWNvcmRJZGVudGl0aWVzIH0gZnJvbSAnLi9yZWNvcmQnO1xyXG5pbXBvcnQgeyBlcSwgZGVlcEdldCwgZGVlcFNldCB9IGZyb20gJ0BvcmJpdC91dGlscyc7XHJcblxyXG4vKipcclxuICogQmFzZSBPcGVyYXRpb24gaW50ZXJmYWNlLCB3aGljaCByZXF1aXJlcyBqdXN0IGFuIGBvcGAgc3RyaW5nLlxyXG4gKlxyXG4gKiBAZXhwb3J0XHJcbiAqIEBpbnRlcmZhY2UgT3BlcmF0aW9uXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIE9wZXJhdGlvbiB7XHJcbiAgb3A6IHN0cmluZztcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCByZWNvcmQgb3BlcmF0aW9uLlxyXG4gKlxyXG4gKiBAZXhwb3J0XHJcbiAqIEBpbnRlcmZhY2UgQWRkUmVjb3JkT3BlcmF0aW9uXHJcbiAqIEBleHRlbmRzIHtPcGVyYXRpb259XHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIEFkZFJlY29yZE9wZXJhdGlvbiBleHRlbmRzIE9wZXJhdGlvbiB7XHJcbiAgb3A6ICdhZGRSZWNvcmQnO1xyXG4gIHJlY29yZDogUmVjb3JkO1xyXG59XHJcblxyXG4vKipcclxuICogUmVwbGFjZSByZWNvcmQgb3BlcmF0aW9uLlxyXG4gKlxyXG4gKiBAZXhwb3J0XHJcbiAqIEBpbnRlcmZhY2UgUmVwbGFjZVJlY29yZE9wZXJhdGlvblxyXG4gKiBAZXh0ZW5kcyB7T3BlcmF0aW9ufVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBSZXBsYWNlUmVjb3JkT3BlcmF0aW9uIGV4dGVuZHMgT3BlcmF0aW9uIHtcclxuICBvcDogJ3JlcGxhY2VSZWNvcmQnO1xyXG4gIHJlY29yZDogUmVjb3JkO1xyXG59XHJcblxyXG4vKipcclxuICogUmVtb3ZlIHJlY29yZCBvcGVyYXRpb24uXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGludGVyZmFjZSBSZW1vdmVSZWNvcmRPcGVyYXRpb25cclxuICogQGV4dGVuZHMge09wZXJhdGlvbn1cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmVtb3ZlUmVjb3JkT3BlcmF0aW9uIGV4dGVuZHMgT3BlcmF0aW9uIHtcclxuICBvcDogJ3JlbW92ZVJlY29yZCc7XHJcbiAgcmVjb3JkOiBSZWNvcmRJZGVudGl0eTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJlcGxhY2Uga2V5IG9wZXJhdGlvbi5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAaW50ZXJmYWNlIFJlcGxhY2VLZXlPcGVyYXRpb25cclxuICogQGV4dGVuZHMge09wZXJhdGlvbn1cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmVwbGFjZUtleU9wZXJhdGlvbiBleHRlbmRzIE9wZXJhdGlvbiB7XHJcbiAgb3A6ICdyZXBsYWNlS2V5JztcclxuICByZWNvcmQ6IFJlY29yZElkZW50aXR5O1xyXG4gIGtleTogc3RyaW5nO1xyXG4gIHZhbHVlOiBzdHJpbmc7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXBsYWNlIGF0dHJpYnV0ZSBvcGVyYXRpb24uXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGludGVyZmFjZSBSZXBsYWNlQXR0cmlidXRlT3BlcmF0aW9uXHJcbiAqIEBleHRlbmRzIHtPcGVyYXRpb259XHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFJlcGxhY2VBdHRyaWJ1dGVPcGVyYXRpb24gZXh0ZW5kcyBPcGVyYXRpb24ge1xyXG4gIG9wOiAncmVwbGFjZUF0dHJpYnV0ZSc7XHJcbiAgcmVjb3JkOiBSZWNvcmRJZGVudGl0eTtcclxuICBhdHRyaWJ1dGU6IHN0cmluZztcclxuICB2YWx1ZTogYW55O1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIHRvIGhhcy1tYW55IHJlbGF0aW9uc2hpcCBvcGVyYXRpb24uXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGludGVyZmFjZSBBZGRUb1JlbGF0ZWRSZWNvcmRzT3BlcmF0aW9uXHJcbiAqIEBleHRlbmRzIHtPcGVyYXRpb259XHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIEFkZFRvUmVsYXRlZFJlY29yZHNPcGVyYXRpb24gZXh0ZW5kcyBPcGVyYXRpb24ge1xyXG4gIG9wOiAnYWRkVG9SZWxhdGVkUmVjb3Jkcyc7XHJcbiAgcmVjb3JkOiBSZWNvcmRJZGVudGl0eTtcclxuICByZWxhdGlvbnNoaXA6IHN0cmluZztcclxuICByZWxhdGVkUmVjb3JkOiBSZWNvcmRJZGVudGl0eTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJlbW92ZSBmcm9tIGhhcy1tYW55IHJlbGF0aW9uc2hpcCBvcGVyYXRpb24uXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGludGVyZmFjZSBSZW1vdmVGcm9tUmVsYXRlZFJlY29yZHNPcGVyYXRpb25cclxuICogQGV4dGVuZHMge09wZXJhdGlvbn1cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmVtb3ZlRnJvbVJlbGF0ZWRSZWNvcmRzT3BlcmF0aW9uIGV4dGVuZHMgT3BlcmF0aW9uIHtcclxuICBvcDogJ3JlbW92ZUZyb21SZWxhdGVkUmVjb3Jkcyc7XHJcbiAgcmVjb3JkOiBSZWNvcmRJZGVudGl0eTtcclxuICByZWxhdGlvbnNoaXA6IHN0cmluZztcclxuICByZWxhdGVkUmVjb3JkOiBSZWNvcmRJZGVudGl0eTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJlcGxhY2UgaGFzLW1hbnkgcmVsYXRpb25zaGlwIG9wZXJhdGlvbi5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAaW50ZXJmYWNlIFJlcGxhY2VSZWxhdGVkUmVjb3Jkc09wZXJhdGlvblxyXG4gKiBAZXh0ZW5kcyB7T3BlcmF0aW9ufVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBSZXBsYWNlUmVsYXRlZFJlY29yZHNPcGVyYXRpb24gZXh0ZW5kcyBPcGVyYXRpb24ge1xyXG4gIG9wOiAncmVwbGFjZVJlbGF0ZWRSZWNvcmRzJztcclxuICByZWNvcmQ6IFJlY29yZElkZW50aXR5O1xyXG4gIHJlbGF0aW9uc2hpcDogc3RyaW5nO1xyXG4gIHJlbGF0ZWRSZWNvcmRzOiBSZWNvcmRJZGVudGl0eVtdO1xyXG59XHJcblxyXG4vKipcclxuICogUmVwbGFjZSBoYXMtb25lIHJlbGF0aW9uc2hpcCBvcGVyYXRpb24uXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQGludGVyZmFjZSBSZXBsYWNlUmVsYXRlZFJlY29yZE9wZXJhdGlvblxyXG4gKiBAZXh0ZW5kcyB7T3BlcmF0aW9ufVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBSZXBsYWNlUmVsYXRlZFJlY29yZE9wZXJhdGlvbiBleHRlbmRzIE9wZXJhdGlvbiB7XHJcbiAgb3A6ICdyZXBsYWNlUmVsYXRlZFJlY29yZCc7XHJcbiAgcmVjb3JkOiBSZWNvcmRJZGVudGl0eTtcclxuICByZWxhdGlvbnNoaXA6IHN0cmluZztcclxuICByZWxhdGVkUmVjb3JkOiBSZWNvcmRJZGVudGl0eSB8IG51bGw7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBVbmlvbiBvZiBhbGwgcmVjb3JkLXJlbGF0ZWQgb3BlcmF0aW9ucy5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKi9cclxuZXhwb3J0IHR5cGUgUmVjb3JkT3BlcmF0aW9uID0gQWRkUmVjb3JkT3BlcmF0aW9uIHxcclxuICBSZXBsYWNlUmVjb3JkT3BlcmF0aW9uIHxcclxuICBSZW1vdmVSZWNvcmRPcGVyYXRpb24gfFxyXG4gIFJlcGxhY2VLZXlPcGVyYXRpb24gfFxyXG4gIFJlcGxhY2VBdHRyaWJ1dGVPcGVyYXRpb24gfFxyXG4gIEFkZFRvUmVsYXRlZFJlY29yZHNPcGVyYXRpb24gfFxyXG4gIFJlbW92ZUZyb21SZWxhdGVkUmVjb3Jkc09wZXJhdGlvbiB8XHJcbiAgUmVwbGFjZVJlbGF0ZWRSZWNvcmRzT3BlcmF0aW9uIHxcclxuICBSZXBsYWNlUmVsYXRlZFJlY29yZE9wZXJhdGlvbjtcclxuXHJcbmZ1bmN0aW9uIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShvcGVyYXRpb246IE9wZXJhdGlvbik6IHZvaWQge1xyXG4gIGNvbnN0IG86IGFueSA9IG9wZXJhdGlvbjtcclxuICBvLl9kZWxldGVkID0gdHJ1ZTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNPcGVyYXRpb25NYXJrZWRUb0RlbGV0ZShvcGVyYXRpb246IE9wZXJhdGlvbik6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IG86IGFueSA9IG9wZXJhdGlvbjtcclxuICByZXR1cm4gby5fZGVsZXRlZCA9PT0gdHJ1ZTtcclxufVxyXG5cclxuZnVuY3Rpb24gbWVyZ2VPcGVyYXRpb25zKHN1cGVyY2VkZWQ6IFJlY29yZE9wZXJhdGlvbiwgc3VwZXJjZWRpbmc6IFJlY29yZE9wZXJhdGlvbiwgY29uc2VjdXRpdmVPcHM6IGJvb2xlYW4pOiB2b2lkIHtcclxuICBpZiAoZXF1YWxSZWNvcmRJZGVudGl0aWVzKHN1cGVyY2VkZWQucmVjb3JkLCBzdXBlcmNlZGluZy5yZWNvcmQpKSB7XHJcbiAgICBpZiAoc3VwZXJjZWRpbmcub3AgPT09ICdyZW1vdmVSZWNvcmQnKSB7XHJcbiAgICAgIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShzdXBlcmNlZGVkKTtcclxuICAgICAgaWYgKHN1cGVyY2VkZWQub3AgPT09ICdhZGRSZWNvcmQnKSB7XHJcbiAgICAgICAgbWFya09wZXJhdGlvblRvRGVsZXRlKHN1cGVyY2VkaW5nKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICghaXNPcGVyYXRpb25NYXJrZWRUb0RlbGV0ZShzdXBlcmNlZGluZykgJiYgKGNvbnNlY3V0aXZlT3BzIHx8IHN1cGVyY2VkaW5nLm9wID09PSAncmVwbGFjZUF0dHJpYnV0ZScpKSB7XHJcbiAgICAgIGlmIChpc1JlcGxhY2VGaWVsZE9wKHN1cGVyY2VkZWQub3ApICYmIGlzUmVwbGFjZUZpZWxkT3Aoc3VwZXJjZWRpbmcub3ApKSB7XHJcbiAgICAgICAgaWYgKHN1cGVyY2VkZWQub3AgPT09ICdyZXBsYWNlQXR0cmlidXRlJyAmJlxyXG4gICAgICAgICAgICBzdXBlcmNlZGluZy5vcCA9PT0gJ3JlcGxhY2VBdHRyaWJ1dGUnICYmXHJcbiAgICAgICAgICAgIHN1cGVyY2VkZWQuYXR0cmlidXRlID09PSBzdXBlcmNlZGluZy5hdHRyaWJ1dGUpIHtcclxuICAgICAgICAgIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShzdXBlcmNlZGVkKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHN1cGVyY2VkZWQub3AgPT09ICdyZXBsYWNlUmVsYXRlZFJlY29yZCcgJiZcclxuICAgICAgICAgICAgc3VwZXJjZWRpbmcub3AgPT09ICdyZXBsYWNlUmVsYXRlZFJlY29yZCcgJiZcclxuICAgICAgICAgICAgc3VwZXJjZWRlZC5yZWxhdGlvbnNoaXAgPT09IHN1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcCkge1xyXG4gICAgICAgICAgbWFya09wZXJhdGlvblRvRGVsZXRlKHN1cGVyY2VkZWQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc3VwZXJjZWRlZC5vcCA9PT0gJ3JlcGxhY2VSZWxhdGVkUmVjb3JkcycgJiZcclxuICAgICAgICAgICAgc3VwZXJjZWRpbmcub3AgPT09ICdyZXBsYWNlUmVsYXRlZFJlY29yZHMnICYmXHJcbiAgICAgICAgICAgIHN1cGVyY2VkZWQucmVsYXRpb25zaGlwID09PSBzdXBlcmNlZGluZy5yZWxhdGlvbnNoaXApIHtcclxuICAgICAgICAgIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShzdXBlcmNlZGVkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaWYgKHN1cGVyY2VkZWQub3AgPT09ICdyZXBsYWNlQXR0cmlidXRlJykge1xyXG4gICAgICAgICAgICB1cGRhdGVSZWNvcmRSZXBsYWNlQXR0cmlidXRlKHN1cGVyY2VkZWQucmVjb3JkLCBzdXBlcmNlZGVkLmF0dHJpYnV0ZSwgc3VwZXJjZWRlZC52YWx1ZSk7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBzdXBlcmNlZGVkLmF0dHJpYnV0ZTtcclxuICAgICAgICAgICAgZGVsZXRlIHN1cGVyY2VkZWQudmFsdWU7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKHN1cGVyY2VkZWQub3AgPT09ICdyZXBsYWNlUmVsYXRlZFJlY29yZCcpIHtcclxuICAgICAgICAgICAgdXBkYXRlUmVjb3JkUmVwbGFjZUhhc09uZShzdXBlcmNlZGVkLnJlY29yZCwgc3VwZXJjZWRlZC5yZWxhdGlvbnNoaXAsIHN1cGVyY2VkZWQucmVsYXRlZFJlY29yZCk7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBzdXBlcmNlZGVkLnJlbGF0aW9uc2hpcDtcclxuICAgICAgICAgICAgZGVsZXRlIHN1cGVyY2VkZWQucmVsYXRlZFJlY29yZDtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoc3VwZXJjZWRlZC5vcCA9PT0gJ3JlcGxhY2VSZWxhdGVkUmVjb3JkcycpIHtcclxuICAgICAgICAgICAgdXBkYXRlUmVjb3JkUmVwbGFjZUhhc01hbnkoc3VwZXJjZWRlZC5yZWNvcmQsIHN1cGVyY2VkZWQucmVsYXRpb25zaGlwLCBzdXBlcmNlZGVkLnJlbGF0ZWRSZWNvcmRzKTtcclxuICAgICAgICAgICAgZGVsZXRlIHN1cGVyY2VkZWQucmVsYXRpb25zaGlwO1xyXG4gICAgICAgICAgICBkZWxldGUgc3VwZXJjZWRlZC5yZWxhdGVkUmVjb3JkcztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChzdXBlcmNlZGluZy5vcCA9PT0gJ3JlcGxhY2VBdHRyaWJ1dGUnKSB7XHJcbiAgICAgICAgICAgIHVwZGF0ZVJlY29yZFJlcGxhY2VBdHRyaWJ1dGUoc3VwZXJjZWRlZC5yZWNvcmQsIHN1cGVyY2VkaW5nLmF0dHJpYnV0ZSwgc3VwZXJjZWRpbmcudmFsdWUpO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChzdXBlcmNlZGluZy5vcCA9PT0gJ3JlcGxhY2VSZWxhdGVkUmVjb3JkJykge1xyXG4gICAgICAgICAgICB1cGRhdGVSZWNvcmRSZXBsYWNlSGFzT25lKHN1cGVyY2VkZWQucmVjb3JkLCBzdXBlcmNlZGluZy5yZWxhdGlvbnNoaXAsIHN1cGVyY2VkaW5nLnJlbGF0ZWRSZWNvcmQpO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChzdXBlcmNlZGluZy5vcCA9PT0gJ3JlcGxhY2VSZWxhdGVkUmVjb3JkcycpIHtcclxuICAgICAgICAgICAgdXBkYXRlUmVjb3JkUmVwbGFjZUhhc01hbnkoc3VwZXJjZWRlZC5yZWNvcmQsIHN1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcCwgc3VwZXJjZWRpbmcucmVsYXRlZFJlY29yZHMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgc3VwZXJjZWRlZC5vcCA9ICdyZXBsYWNlUmVjb3JkJztcclxuICAgICAgICAgIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShzdXBlcmNlZGluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKChzdXBlcmNlZGVkLm9wID09PSAnYWRkUmVjb3JkJyB8fCBzdXBlcmNlZGVkLm9wID09PSAncmVwbGFjZVJlY29yZCcpICYmXHJcbiAgICAgICAgICAgICAgICAgaXNSZXBsYWNlRmllbGRPcChzdXBlcmNlZGluZy5vcCkpIHtcclxuICAgICAgICBpZiAoc3VwZXJjZWRpbmcub3AgPT09ICdyZXBsYWNlQXR0cmlidXRlJykge1xyXG4gICAgICAgICAgdXBkYXRlUmVjb3JkUmVwbGFjZUF0dHJpYnV0ZShzdXBlcmNlZGVkLnJlY29yZCwgc3VwZXJjZWRpbmcuYXR0cmlidXRlLCBzdXBlcmNlZGluZy52YWx1ZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChzdXBlcmNlZGluZy5vcCA9PT0gJ3JlcGxhY2VSZWxhdGVkUmVjb3JkJykge1xyXG4gICAgICAgICAgdXBkYXRlUmVjb3JkUmVwbGFjZUhhc09uZShzdXBlcmNlZGVkLnJlY29yZCwgc3VwZXJjZWRpbmcucmVsYXRpb25zaGlwLCBzdXBlcmNlZGluZy5yZWxhdGVkUmVjb3JkKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHN1cGVyY2VkaW5nLm9wID09PSAncmVwbGFjZVJlbGF0ZWRSZWNvcmRzJykge1xyXG4gICAgICAgICAgdXBkYXRlUmVjb3JkUmVwbGFjZUhhc01hbnkoc3VwZXJjZWRlZC5yZWNvcmQsIHN1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcCwgc3VwZXJjZWRpbmcucmVsYXRlZFJlY29yZHMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtYXJrT3BlcmF0aW9uVG9EZWxldGUoc3VwZXJjZWRpbmcpO1xyXG4gICAgICB9IGVsc2UgaWYgKHN1cGVyY2VkaW5nLm9wID09PSAnYWRkVG9SZWxhdGVkUmVjb3JkcycpIHtcclxuICAgICAgICBpZiAoc3VwZXJjZWRlZC5vcCA9PT0gJ2FkZFJlY29yZCcpIHtcclxuICAgICAgICAgIHVwZGF0ZVJlY29yZEFkZFRvSGFzTWFueShzdXBlcmNlZGVkLnJlY29yZCwgc3VwZXJjZWRpbmcucmVsYXRpb25zaGlwLCBzdXBlcmNlZGluZy5yZWxhdGVkUmVjb3JkKTtcclxuICAgICAgICAgIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShzdXBlcmNlZGluZyk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChzdXBlcmNlZGVkLm9wID09PSAncmVwbGFjZVJlY29yZCcpIHtcclxuICAgICAgICAgIGlmIChzdXBlcmNlZGVkLnJlY29yZC5yZWxhdGlvbnNoaXBzICYmXHJcbiAgICAgICAgICAgICAgc3VwZXJjZWRlZC5yZWNvcmQucmVsYXRpb25zaGlwc1tzdXBlcmNlZGluZy5yZWxhdGlvbnNoaXBdICYmXHJcbiAgICAgICAgICAgICAgc3VwZXJjZWRlZC5yZWNvcmQucmVsYXRpb25zaGlwc1tzdXBlcmNlZGluZy5yZWxhdGlvbnNoaXBdLmRhdGEpIHtcclxuICAgICAgICAgICAgdXBkYXRlUmVjb3JkQWRkVG9IYXNNYW55KHN1cGVyY2VkZWQucmVjb3JkLCBzdXBlcmNlZGluZy5yZWxhdGlvbnNoaXAsIHN1cGVyY2VkaW5nLnJlbGF0ZWRSZWNvcmQpO1xyXG4gICAgICAgICAgICBtYXJrT3BlcmF0aW9uVG9EZWxldGUoc3VwZXJjZWRpbmcpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChzdXBlcmNlZGluZy5vcCA9PT0gJ3JlbW92ZUZyb21SZWxhdGVkUmVjb3JkcycpIHtcclxuICAgICAgICBpZiAoc3VwZXJjZWRlZC5vcCA9PT0gJ2FkZFRvUmVsYXRlZFJlY29yZHMnICYmXHJcbiAgICAgICAgICAgIHN1cGVyY2VkZWQucmVsYXRpb25zaGlwID09PSBzdXBlcmNlZGluZy5yZWxhdGlvbnNoaXAgJiZcclxuICAgICAgICAgICAgZXF1YWxSZWNvcmRJZGVudGl0aWVzKHN1cGVyY2VkZWQucmVsYXRlZFJlY29yZCwgc3VwZXJjZWRpbmcucmVsYXRlZFJlY29yZCkpIHtcclxuICAgICAgICAgIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShzdXBlcmNlZGVkKTtcclxuICAgICAgICAgIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShzdXBlcmNlZGluZyk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChzdXBlcmNlZGVkLm9wID09PSAnYWRkUmVjb3JkJyB8fCBzdXBlcmNlZGVkLm9wID09PSAncmVwbGFjZVJlY29yZCcpIHtcclxuICAgICAgICAgIGlmIChzdXBlcmNlZGVkLnJlY29yZC5yZWxhdGlvbnNoaXBzICYmXHJcbiAgICAgICAgICAgICAgc3VwZXJjZWRlZC5yZWNvcmQucmVsYXRpb25zaGlwc1tzdXBlcmNlZGluZy5yZWxhdGlvbnNoaXBdICYmXHJcbiAgICAgICAgICAgICAgc3VwZXJjZWRlZC5yZWNvcmQucmVsYXRpb25zaGlwc1tzdXBlcmNlZGluZy5yZWxhdGlvbnNoaXBdLmRhdGEpIHtcclxuICAgICAgICAgICAgdXBkYXRlUmVjb3JkUmVtb3ZlRnJvbUhhc01hbnkoc3VwZXJjZWRlZC5yZWNvcmQsIHN1cGVyY2VkaW5nLnJlbGF0aW9uc2hpcCwgc3VwZXJjZWRpbmcucmVsYXRlZFJlY29yZCk7XHJcbiAgICAgICAgICAgIG1hcmtPcGVyYXRpb25Ub0RlbGV0ZShzdXBlcmNlZGluZyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBpc1JlcGxhY2VGaWVsZE9wKG9wOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICByZXR1cm4gKG9wID09PSAncmVwbGFjZUF0dHJpYnV0ZScgfHxcclxuICAgICAgICAgIG9wID09PSAncmVwbGFjZVJlbGF0ZWRSZWNvcmQnIHx8XHJcbiAgICAgICAgICBvcCA9PT0gJ3JlcGxhY2VSZWxhdGVkUmVjb3JkcycpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVSZWNvcmRSZXBsYWNlQXR0cmlidXRlKHJlY29yZDogUmVjb3JkLCBhdHRyaWJ1dGU6IHN0cmluZywgdmFsdWU6IGFueSkge1xyXG4gIHJlY29yZC5hdHRyaWJ1dGVzID0gcmVjb3JkLmF0dHJpYnV0ZXMgfHwge307XHJcbiAgcmVjb3JkLmF0dHJpYnV0ZXNbYXR0cmlidXRlXSA9IHZhbHVlO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVSZWNvcmRSZXBsYWNlSGFzT25lKHJlY29yZDogUmVjb3JkLCByZWxhdGlvbnNoaXA6IHN0cmluZywgcmVsYXRlZFJlY29yZDogUmVjb3JkSWRlbnRpdHkpIHtcclxuICBkZWVwU2V0KHJlY29yZCwgWydyZWxhdGlvbnNoaXBzJywgcmVsYXRpb25zaGlwLCAnZGF0YSddLCBjbG9uZVJlY29yZElkZW50aXR5KHJlbGF0ZWRSZWNvcmQpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlUmVjb3JkUmVwbGFjZUhhc01hbnkocmVjb3JkOiBSZWNvcmQsIHJlbGF0aW9uc2hpcDogc3RyaW5nLCByZWxhdGVkUmVjb3JkczogUmVjb3JkSWRlbnRpdHlbXSkge1xyXG4gIGRlZXBTZXQocmVjb3JkLCBbJ3JlbGF0aW9uc2hpcHMnLCByZWxhdGlvbnNoaXAsICdkYXRhJ10sIHJlbGF0ZWRSZWNvcmRzLm1hcChjbG9uZVJlY29yZElkZW50aXR5KSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVJlY29yZEFkZFRvSGFzTWFueShyZWNvcmQ6IFJlY29yZCwgcmVsYXRpb25zaGlwOiBzdHJpbmcsIHJlbGF0ZWRSZWNvcmQ6IFJlY29yZElkZW50aXR5KSB7XHJcbiAgY29uc3QgZGF0YSA9IGRlZXBHZXQocmVjb3JkLCBbJ3JlbGF0aW9uc2hpcHMnLCByZWxhdGlvbnNoaXAsICdkYXRhJ10pIHx8IFtdO1xyXG4gIGRhdGEucHVzaChjbG9uZVJlY29yZElkZW50aXR5KHJlbGF0ZWRSZWNvcmQpKTtcclxuICBkZWVwU2V0KHJlY29yZCwgWydyZWxhdGlvbnNoaXBzJywgcmVsYXRpb25zaGlwLCAnZGF0YSddLCBkYXRhKTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlUmVjb3JkUmVtb3ZlRnJvbUhhc01hbnkocmVjb3JkOiBSZWNvcmQsIHJlbGF0aW9uc2hpcDogc3RyaW5nLCByZWxhdGVkUmVjb3JkOiBSZWNvcmRJZGVudGl0eSkge1xyXG4gIGNvbnN0IGRhdGEgPSBkZWVwR2V0KHJlY29yZCwgWydyZWxhdGlvbnNoaXBzJywgcmVsYXRpb25zaGlwLCAnZGF0YSddKSBhcyBSZWNvcmRJZGVudGl0eVtdO1xyXG4gIGlmIChkYXRhKSB7XHJcbiAgICBmb3IgKGxldCBpID0gMCwgbCA9IGRhdGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcbiAgICAgIGxldCByID0gZGF0YVtpXTtcclxuICAgICAgaWYgKGVxdWFsUmVjb3JkSWRlbnRpdGllcyhyLCByZWxhdGVkUmVjb3JkKSkge1xyXG4gICAgICAgIGRhdGEuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ29hbGVzY2VzIG9wZXJhdGlvbnMgaW50byBhIG1pbmltYWwgc2V0IG9mIGVxdWl2YWxlbnQgb3BlcmF0aW9ucy5cclxuICpcclxuICogVGhpcyBtZXRob2QgcmVzcGVjdHMgdGhlIG9yZGVyIG9mIHRoZSBvcGVyYXRpb25zIGFycmF5IGFuZCBkb2VzIG5vdCBhbGxvd1xyXG4gKiByZW9yZGVyaW5nIG9mIG9wZXJhdGlvbnMgdGhhdCBhZmZlY3QgcmVsYXRpb25zaGlwcy5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAcGFyYW0ge1JlY29yZE9wZXJhdGlvbltdfSBvcGVyYXRpb25zXHJcbiAqIEByZXR1cm5zIHtSZWNvcmRPcGVyYXRpb25bXX1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjb2FsZXNjZVJlY29yZE9wZXJhdGlvbnMob3BlcmF0aW9uczogUmVjb3JkT3BlcmF0aW9uW10pOiBSZWNvcmRPcGVyYXRpb25bXSB7XHJcbiAgZm9yIChsZXQgaSA9IDAsIGwgPSBvcGVyYXRpb25zLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgbGV0IGN1cnJlbnRPcCA9IG9wZXJhdGlvbnNbaV07XHJcbiAgICBsZXQgY29uc2VjdXRpdmVPcHMgPSB0cnVlO1xyXG5cclxuICAgIGZvciAobGV0IGogPSBpICsgMTsgaiA8IGw7IGorKykge1xyXG4gICAgICBsZXQgbmV4dE9wID0gb3BlcmF0aW9uc1tqXTtcclxuXHJcbiAgICAgIG1lcmdlT3BlcmF0aW9ucyhjdXJyZW50T3AsIG5leHRPcCwgY29uc2VjdXRpdmVPcHMpO1xyXG5cclxuICAgICAgaWYgKGlzT3BlcmF0aW9uTWFya2VkVG9EZWxldGUoY3VycmVudE9wKSkge1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9IGVsc2UgaWYgKCFpc09wZXJhdGlvbk1hcmtlZFRvRGVsZXRlKG5leHRPcCkpIHtcclxuICAgICAgICBjb25zZWN1dGl2ZU9wcyA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gb3BlcmF0aW9ucy5maWx0ZXIobyA9PiAhaXNPcGVyYXRpb25NYXJrZWRUb0RlbGV0ZShvKSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZXRlcm1pbmUgdGhlIGRpZmZlcmVuY2VzIGJldHdlZW4gYSByZWNvcmQgYW5kIGl0cyB1cGRhdGVkIHZlcnNpb24gaW4gdGVybXNcclxuICogb2YgYSBzZXQgb2Ygb3BlcmF0aW9ucy5cclxuICpcclxuICogQGV4cG9ydFxyXG4gKiBAcGFyYW0ge1JlY29yZH0gcmVjb3JkXHJcbiAqIEBwYXJhbSB7UmVjb3JkfSB1cGRhdGVkUmVjb3JkXHJcbiAqIEByZXR1cm5zIHtSZWNvcmRPcGVyYXRpb25bXX1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiByZWNvcmREaWZmcyhyZWNvcmQ6IFJlY29yZCwgdXBkYXRlZFJlY29yZDogUmVjb3JkKTogUmVjb3JkT3BlcmF0aW9uW10ge1xyXG4gIGNvbnN0IGRpZmZzOiBSZWNvcmRPcGVyYXRpb25bXSA9IFtdO1xyXG5cclxuICBpZiAocmVjb3JkICYmIHVwZGF0ZWRSZWNvcmQpIHtcclxuICAgIGNvbnN0IHJlY29yZElkZW50aXR5ID0gY2xvbmVSZWNvcmRJZGVudGl0eShyZWNvcmQpO1xyXG5cclxuICAgIGlmICh1cGRhdGVkUmVjb3JkLmF0dHJpYnV0ZXMpIHtcclxuICAgICAgT2JqZWN0LmtleXModXBkYXRlZFJlY29yZC5hdHRyaWJ1dGVzKS5mb3JFYWNoKGF0dHJpYnV0ZSA9PiB7XHJcbiAgICAgICAgbGV0IHZhbHVlID0gdXBkYXRlZFJlY29yZC5hdHRyaWJ1dGVzW2F0dHJpYnV0ZV07XHJcblxyXG4gICAgICAgIGlmIChyZWNvcmQuYXR0cmlidXRlcyA9PT0gdW5kZWZpbmVkIHx8ICFlcShyZWNvcmQuYXR0cmlidXRlc1thdHRyaWJ1dGVdLCB2YWx1ZSkpIHtcclxuICAgICAgICAgIGxldCBvcDogUmVwbGFjZUF0dHJpYnV0ZU9wZXJhdGlvbiA9IHtcclxuICAgICAgICAgICAgb3A6ICdyZXBsYWNlQXR0cmlidXRlJyxcclxuICAgICAgICAgICAgcmVjb3JkOiByZWNvcmRJZGVudGl0eSxcclxuICAgICAgICAgICAgYXR0cmlidXRlLFxyXG4gICAgICAgICAgICB2YWx1ZVxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGRpZmZzLnB1c2gob3ApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHVwZGF0ZWRSZWNvcmQua2V5cykge1xyXG4gICAgICBPYmplY3Qua2V5cyh1cGRhdGVkUmVjb3JkLmtleXMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICBsZXQgdmFsdWUgPSB1cGRhdGVkUmVjb3JkLmtleXNba2V5XTtcclxuICAgICAgICBpZiAocmVjb3JkLmtleXMgPT09IHVuZGVmaW5lZCB8fCAhZXEocmVjb3JkLmtleXNba2V5XSwgdmFsdWUpKSB7XHJcbiAgICAgICAgICBsZXQgb3A6IFJlcGxhY2VLZXlPcGVyYXRpb24gPSB7XHJcbiAgICAgICAgICAgIG9wOiAncmVwbGFjZUtleScsXHJcbiAgICAgICAgICAgIHJlY29yZDogcmVjb3JkSWRlbnRpdHksXHJcbiAgICAgICAgICAgIGtleSxcclxuICAgICAgICAgICAgdmFsdWVcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBkaWZmcy5wdXNoKG9wKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRPRE8gLSBoYW5kbGUgcmVsYXRpb25zaGlwc1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGRpZmZzO1xyXG59XHJcbiJdfQ==